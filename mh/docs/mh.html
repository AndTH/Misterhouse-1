<HTML>
<HEAD>
<TITLE>B<mh> - MisterHouse Home Automation Program</TITLE>
<LINK REV="made" HREF="mailto:">
</HEAD>

<BODY>

<A NAME="__index__"></A>
<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#name">NAME</A></LI>
	<LI><A HREF="#synopsis">SYNOPSIS</A></LI>
	<UL>

		<LI><A HREF="#usage options">Usage Options</A></LI>
		<LI><A HREF="#usage examples">Usage Examples</A></LI>
		<LI><A HREF="#installation">Installation</A></LI>
	</UL>

	<LI><A HREF="#description">DESCRIPTION</A></LI>
	<UL>

		<LI><A HREF="#mh overview">mh overview</A></LI>
		<LI><A HREF="#perl info">Perl Info</A></LI>
		<LI><A HREF="#list of supported hardware interfaces">List of supported hardware interfaces</A></LI>
		<LI><A HREF="#list of startup options">List of startup options</A></LI>
		<LI><A HREF="#list of global variables">List of global variables</A></LI>
		<LI><A HREF="#list of objects and their methods">List of objects and their methods</A></LI>
		<LI><A HREF="#list of functions">List of functions</A></LI>
		<LI><A HREF="#list of tk widget functions">List of tk widget functions</A></LI>
		<LI><A HREF="#list of internet functions">List of Internet functions</A></LI>
		<LI><A HREF="#list of companion programs">List of companion programs</A></LI>
		<LI><A HREF="#authentication">Authentication</A></LI>
		<LI><A HREF="#customizing the menu interfaces">Customizing the Menu interfaces</A></LI>
		<LI><A HREF="#customizing the tk interface">Customizing the Tk Interface</A></LI>
		<LI><A HREF="#customizing the web interface">Customizing the Web Interface</A></LI>
		<LI><A HREF="#voice recognition (vr) and text to speech (tts) on windows">Voice Recognition (VR) and Text To Speech (TTS) on windows</A></LI>
		<LI><A HREF="#voice recognition (vr) and text to speech (tts) on unix">Voice Recognition (VR) and Text To Speech (TTS) on Unix</A></LI>
	</UL>

	<LI><A HREF="#notes">NOTES</A></LI>
	<LI><A HREF="#known limitations and bugs">KNOWN LIMITATIONS AND BUGS</A></LI>
	<UL>

		<LI><A HREF="#general bugs/limitations">General bugs/limitations</A></LI>
		<LI><A HREF="#windows bugs/limitations">Windows bugs/limitations</A></LI>
		<LI><A HREF="#unix bugs/limitations">Unix bugs/limitations</A></LI>
	</UL>

	<LI><A HREF="#authors">AUTHORS</A></LI>
	<LI><A HREF="#see also">SEE ALSO</A></LI>
	<LI><A HREF="#copyright">COPYRIGHT</A></LI>
	<LI><A HREF="#disclaimer">DISCLAIMER</A></LI>
</UL>
<!-- INDEX END -->

<HR>
<P>
<HR>
<H1><A NAME="name">NAME</A></H1>
<P><STRONG>mh</STRONG> - MisterHouse Home Automation Program</P>
<P>
<HR>
<H1><A NAME="synopsis">SYNOPSIS</A></H1>
<P><STRONG>mh</STRONG> is a perl program for time, event, web, socket, and voice based home control functions.  It currently
runs on Windows 95/98/NT and on Unix platforms, including Linux.</P>
<P>perl objects are used for various types of objects to give a powerful but 
concise programming interface.  Here is some example code:</P>
<PRE>
   $dishwasher = new X10_Item 'B1';         # B1 is the dishwasher X10 code 
   set $dishwasher ON if time_now '10:30 PM';</PRE>
<PRE>
   speak &quot;I am now closing the curtains at $Time_Now&quot; if time_now &quot;$Time_Sunset + 0:15&quot;; 
   speak &quot;The time is $Time_Now&quot; if time_cron '30,35,40,45,50 6 * * 1-5';</PRE>
<PRE>
   play(file =&gt; 'stairs_creek*.wav') if state_now $movement_sensor eq ON;</PRE>
<PRE>
   $v_bedroom_curtain = new Voice_Cmd '[open,close] the bedroom curtains';
   curtain_on('bedroom', $state) if $state = said $v_bedroom_curtain;</PRE>
<P>
<H2><A NAME="usage options">Usage Options</A></H2>
<P><STRONG>mh</STRONG> [options] [files]</P>
<P><STRONG>options</STRONG> are controlled in the mh\bin\mh.ini file.  You 
can override the default mh.ini parameters in a 'private' parm file
and point to that with a mh_parms environmental variable.</P>
<P><STRONG>files</STRONG> is a list of members in the -code_dir that you want to run.
The default is to run all .pl files.</P>
<P>
<H2><A NAME="usage examples">Usage Examples</A></H2>
<P>These give the help text:</P>
<PRE>
   mh -h
   mh -help</PRE>
<P>This is the normal usage:</P>
<PRE>
   mh</PRE>
<P>This will only run the 3 specified members:</P>
<PRE>
   mh items.pl test1.pl test2.pl</PRE>
<P>This will disable the tk interface and change the code dir to the Bruce directory:</P>
<PRE>
   mh -tk 0 -code_dir c:\mh\code\Bruce</PRE>
<P>This will log all 'print' statements to /mh/test1.log and turn on all serial related debug messages:</P>
<PRE>
   mh -log_file test1.log -debug serial</PRE>
<P>
<H2><A NAME="installation">Installation</A></H2>
The system requirements and installation instructions are detailed in 
<a href="install.html">mh/docs/install.html</a>
<p>There is also a FAQ that covers misc topics in
<a href="faq.html">mh/docs/faq.html</a><P>
<HR>
<H1><A NAME="description">DESCRIPTION</A></H1>
<P>
<H2><A NAME="mh overview">mh overview</A></H2>
<P>Items and events are defined by using your favorite text editor and creating members
of perl code in a directory of your choice.  For example, all the code that runs
my house is in the /mh/code/bruce directory.</P>
<P>After starting mh, in addition to the timed, serial, or X10 based events that you 
defined, you can trigger mh actions with any of the following:</P>
<PRE>
  - Voice commands.  On Windows platforms, you can use the MSVOICE icon in your tray 
    (the green V) to control the Voice Recognition (VR) mode (manual, 
    keyword-activated, or continuous). You also select your TTS (Text To Speech) 
    voice with MSVOICE.</PRE>
<PRE>
    On Unix platforms you can use the Festival TTS engine and pick among different
    accents and languages.  On Linux, you can install IBM's ViaVoice SDK 
    to enable Voice Recognition.</PRE>
<PRE>
  - A web browser pointed to <A HREF="http://localhost:8080">http://localhost:8080</A> .  In addition to several
    example web interfaces, if you are familiar with HTML, you can write your 
    own customized interface.</PRE>
<PRE>
  - Typing any voice command in a telnet window.  This is customizable
    with the telnet.pl module.</PRE>
<PRE>
  - Typing any voice command in the command box in the mh tk gui window.</PRE>
<PRE>
  - Typing any voice command from a dos box, using the mh/bin/house command</PRE>
<PRE>
  - Having any program write voice commands to the 'xcmd_file' (see mh.ini)</PRE>
<PRE>
  - Triggering on user defined Socket or Serial port events.</PRE>
<P>Here are the basic steps of the mh program:</P>
<PRE>
   1: Read config files and initialize things
</PRE>
<PRE>

       Setup the OLE Text To Speech (TTS) object or Festival socket port
       Setup the OLE Voice Recognition object or socket to the viavoice_server on linux
       Setup the serial objects 
       Setup the tcp socket ports</PRE>
<PRE>
   2: Read and evaluate/compile the user event code into the mh_temp.user_code file:</PRE>
<PRE>
       Optional *.mht files are processed by mh/lib/read_table_*.pl, creating *.mhp files
       Objects are evaluated and created. 
       Everything else is put into a &amp;user_loop function (at the end of mh_temp.user_code file).</PRE>
<PRE>
   3: Loop until exit, each pass executing:</PRE>
<PRE>
       Set global time/date variables 
       Check for voice commands 
       Read/write socket data 
       Read/write serial data 
       Check for timers actions 
       Check for external command files 
       Evaluate the &amp;user_loop function 
       Sleep for a while (default is 100 milliseconds), so mh does not hog the cpu.</PRE>
<P>The interpreted nature of perl allows us to change/add/delete an event member quickly,
without re-starting mh.   After changing code, you tell mh to re-load the user event code (step 2 above).
If there is a syntax error with the new code, the previous version of the code is re-loaded.</P>
<P>Re-loading 20 event members with 1500 lines of event code takes about 2 seconds.
With a 50 millisecond sleep time, mh takes about 2-&gt;5% of the cpu and loops about
18 times per second on our our 150 MHz PPro system.</P>
<P>
<H2><A NAME="perl info">Perl Info</A></H2>
<P>There is lots of good perl info is at <A HREF="http://www.perl.com">http://www.perl.com</A> .
The reference book is ``Programming Perl, 3rd edition'' by Larry Wall, Tom Christensen,
&amp; Randall Schwartz. ISBN 1-56592-149-6. It is available from <A HREF="http://www.oreilly.com">http://www.oreilly.com</A> .  ``The Perl Cookbook'' is 
another good book that has a ton of examples in it.</P>
<P>For those of you using the compiled, instead of the interpreted, version of mh, the 
standard perl documentation can be found at 
<A HREF="http://www.perl.com/pub/v/documentation">http://www.perl.com/pub/v/documentation</A> , 
<A HREF="http://language.perl.com/CPAN/doc/manual/html/index.html">http://language.perl.com/CPAN/doc/manual/html/index.html</A> and/or
<A HREF="http://www.activestate.com/ActivePerl/docs">http://www.activestate.com/ActivePerl/docs</A></P>
<P>Perl can be a pretty intimidating language to learn, due to its many options and functions, but
for the purposes of using it to code mh events, there are only a few simple rules to keep in mind.
Here are a few of them:</P>
<PRE>
   Variables start with a $</PRE>
<PRE>
   Strings are quoted with ' or &quot;. Use &quot; if you want variables within 
   the string to be substituted.</PRE>
<PRE>
   Commands end with ;</PRE>
<PRE>
   Comments start with #</PRE>
<PRE>
   You can implement block comments with =begin, =cut records, as follows:
</PRE>
<PRE>

      print &quot;this will run\n&quot;;</PRE>
<PRE>
      =begin
      print &quot;this&quot;;
      print &quot; will not run\n&quot;;
      =cut</PRE>
<PRE>
      print &quot;all done\n&quot;;</PRE>
<PRE>
   Do loops start and end with { }</PRE>
<PRE>
   If statements can be done either of the following ways:
</PRE>
<PRE>

      if (test) {action} 
      action if test;</PRE>
<PRE>
   If tests are == (or !=) for numeric data and eq (or ne) for string data.</PRE>
<PRE>
   Object methods can be specified 2 ways.
   Here are both examples on how use the method 'set' for an X10 object:</PRE>
<PRE>
      set $dishwasher ON;    # Indirect object form
      $dishwasher-&gt;set(ON);  # Classic 'object oriented' form</PRE>
<PRE>
   Regular expressions are used to parse strings.  They are very powerful
   and can be quite complex, but here are a few simple rules:</PRE>
<PRE>
      They are triggered with the =~ operator
      By default, they are delimited with //
      .  stands for any character (including blanks)
      \S stands for non blank characters (\s is for blanks)
      \d stands for digits
      * is a modifier that means 'zero or more of the previous type of character'
      + is a modifier that means 'one  or more of the previous type of character'
      ? is a modifier that means 'zero or one  of the previous type of character'
      () captures whatever is inside for use via $1, $2, $3, etc</PRE>
<PRE>
   For example:</PRE>
<PRE>
    $data = 'Mar 25, 1998 - 11:53 AM EST / 1998.03.25 1653 UTC';
    $date = $1, $year = $2, $time = $3 if $data =~ /(.+), (\d\d\d\d) - (.+) EST /;</PRE>
<PRE>
   On Windows systems, path names can use the Unix convention of / instead
   of the DOS convention of \.  You can also use \, by typically you must
   'escape it' (e.g. 'c:\\mh' instead of 'c:\mh').</PRE>
<P>
<H2><A NAME="list of supported hardware interfaces">List of supported hardware interfaces</A></H2>
<P>For a list of the hardware in Bruce's house, see mh/pod/faq.* quesion 6.8.</P>
<P>You can get the ActiveHome kit for $50 from at <A HREF="http://www.x10.com">http://www.x10.com</A> .  This
includes a 2 way X10 CM11 interface a lamp module and a couple of remote controllers.
They also sell the CM17 firecracker interface which mh supports, but is a one way interface
only (does not receive X10 signals).</P>
<P>X10.com also sells a $50 IR transimiter that works through the CM17 interface.  
Info is at <A HREF="http://www.x10.com/products/ux17a_bj2.htm.">http://www.x10.com/products/ux17a_bj2.htm.</A>  This is supported
via the mh IR_Item object.</P>
<P>Another nice interface is the $30 MR26A: <A HREF="http://www.x10.com/products/x10_mr26a.htm">http://www.x10.com/products/x10_mr26a.htm</A> 
This will receive the information coming from most of the X10 
RF devices (e.g.  motion sensors, keychains, palmpads, remote controls like UR19, UR47, JR20). 
The advantage to receiving X10 data this way, instead of a powerline device like a CM11,
is it is much faster as data goes from RF -&gt; MR26A -&gt; serial_port -&gt; mh.   
Actions can be triggered in milliseconds, 
without having to wait for the 500+ millisecond time it takes
to transmit data over the powerline.</P>
<P>A nice summary of the different X10 controlers is here:
<A HREF="http://www.geocities.com/ido_bartana/Which_controller.html">http://www.geocities.com/ido_bartana/Which_controller.html</A></P>
<P>Europeans can get X10 stuff from  <A HREF="http://www.intellihome.be">http://www.intellihome.be</A> , 
<A HREF="http://www.hwg-telekom.de">http://www.hwg-telekom.de</A> , <A HREF="http://www.digihouse.com.au">http://www.digihouse.com.au</A> , <A HREF="http://www.eon3.com,">http://www.eon3.com,</A> 
www.madomotique.com, www.letsautomate.com, and www.laser.com .</P>
<P>Weeder Technologies, <A HREF="http://www.weedtech.com">http://www.weedtech.com</A> , offers the following kits
priced from $30 to $50 each.  All of these kits can share the same serial port:</P>
<PRE>
   2 way X10 interface 
   12 bit Digital IO (can be input or output, switch or button) 
   8 port Analog IO, 10 bit resolution 
   Caller ID, name and number 
   Outgoing DTMF phone monitor</PRE>
<P>You can use 1-&gt;2 of the weeder IO kits to drive the 
the 'universal relay kit' from <A HREF="http://jameco.com">http://jameco.com</A> (do a search for
'relay card' or 128910).   The $60 gets you 8 relays.  Here is 
some more info:</P>
<P>1. The board is sold as 8 relays complete, upgradable to 16.  If you only
want to use 8 relays(in a limited fashion), the kit is all you need.</P>
<P>2. If you want more than 8, you need more than just the extra 8 relays
themsleves.
 - you will need 8 extra diodes(1n4148 in my kit)
 - you will need about 30 extra terminating blocks</P>
<P>3. The board comes with spots for leds to show activity, you will need to
provide those as well as the resistors to drive them(none are provided).</P>
<P>4. As delivered, the weeder board will not drive the relays, you will need
to get 2 ULN2803 darligton transistor array chips to do that(The relays
need 12V, the Weeders give 5V).</P>
<P>5. The board has the ability to be manually driven, you will need to buy 2
extra 8 pin dip switches to do that.</P>
<P>6. It comes as a bare open board, so think about an enclosure of some type.</P>
<P>7. All of these parts are available from jameco for nominal extra cost.</P>
<P>The HomeBase.pm module to supports the JDS interfaces, <A HREF="http://www.jdstechnologies.com">http://www.jdstechnologies.com</A> .
See member mh/code/public/test_homebase.pl for example code.</P>
<P>The Homevison.pm module to supports HomeVision controler, <A HREF="http://www.csi3.com/homevis2.htm">http://www.csi3.com/homevis2.htm</A> .
This controler does 2 way X10, 2 way IR, 24 digital IO, and can output its menus to TV.
See member mh/code/public/test_homevision.pl for example code.</P>
<P>The DSC_Alarm.pm module supports the DSC PC5400 serial printer interface.  This 
module prints all events that DSC logs to the event buffer.  These events include
arms/disarms/alarms, user <CODE>code(s)</CODE> that performed action(s), installer access, etc.
DSC does not log individual zone open/close nor 'entry chime' events.
See the mh/lib/DSC_Alarm.pm for further information.
See also the DSC_Alarm item below.</P>
<P>The CPU-XA, Ocelot, and Leopard controlers from Applied Digital Inc
(http://www.appdig.com/adicon.html ) are supported thru
network calls to the cpuxad deamon, part of the XALIB package, 
available at <A HREF="http://members.home.net/ncherry/common/cpuxad">http://members.home.net/ncherry/common/cpuxad</A></P>
<P>There is a $30 (assembled) pic base IR receiver you can order from the
Netherlands ($3 shipping):</P>
<PRE>
  <A HREF="http://www.evation.com/irman/">http://www.evation.com/irman/</A></PRE>
<P>In addition to the mh/code/bruce/irman.html code, there there is free winamp,
windows, and linux software for it.
The schematics that it is built from are also posted on the net (elsewhere), but
for $30, it hardly seems worth building it from scratch.</P>
<P>Here are 2 LCD displays with programable serial interfaces:</P>
<PRE>
  <A HREF="http://www.crystalfontz.com/products/634/index.html">http://www.crystalfontz.com/products/634/index.html</A>  $60</PRE>
<PRE>
  <A HREF="http://linuxcentral.com">http://linuxcentral.com</A>  $80 ($101 with keypad interface)</PRE>
<P>The first display is a bit newer, bigger, brighter, cheaper.  But the second
one has a version that include a 4x4 keypad interface (keypad available from
DigiKey for $20).  Both are 4 lines x 20 characters (they also have a 4x40,
but no keypad interface).    I ordered the 2nd one from linuxcentral, with a
keypad from <A HREF="http://www.digikey.com">http://www.digikey.com</A> (pn  CKN6011-ND or GH5010-ND).   A
comparison of the 2, plus some nifty linux software for them, can be found
at <A HREF="http://lcdproc.omnipotent.net">http://lcdproc.omnipotent.net</A></P>
<P>An example on how to use these displays is in mh/code/bruce/lcdproc.pl.  See the 
header of that file for more info.</P>
<P>Here are a few other devices which look useful, but have not had code written for them:</P>
<PRE>
 <A HREF="http://www.nirvis.com/">http://www.nirvis.com/</A>  $180 2-way IR device</PRE>
<PRE>
 <A HREF="http://www.cc-concepts.com/">http://www.cc-concepts.com/</A>  iButton DigiLock interface as electronic keychain</PRE>
<P>The Serial_Item object can read and write to any serially connect device.  There is example code
in the code/public directory that shows how to interface to a ham radio TNC receiver to decode and track
a GPS transmitters position.</P>
<P>An better, object-oriented way to write code to interface to a new hardware device is in mh/lib/example_interface.pm.</P>
<P>Byterunner offers lots of types of serial cards: <A HREF="http://www.byterunner.com">http://www.byterunner.com</A></P>
<P>Good sources of information on the WX200/WM918 weather stations are at
<A HREF="http://wx200.planetfall.com/">http://wx200.planetfall.com/</A>  and  <A HREF="http://www.weatherwatchers.org/wxstation/WX-200/">http://www.weatherwatchers.org/wxstation/WX-200/</A> .
$200-&gt;$300 at Radio Shack or $200 from <A HREF="http://www.heartlandamerica.com">http://www.heartlandamerica.com</A> (search for weather, model WW22- 3350).
See mh/lib/Weather_wx200* for info on interface code.</P>
<P>There is also now a new WMR-918, which is a wireless version, available for about $350.  An mh interface is being worked on.</P>
<P>iButton is a family of devices that can all talk to a '1 wire' interface.
Here are some urls and prices:</P>
<PRE>
  <A HREF="http://www.ibutton.com">http://www.ibutton.com</A> (pick shop online)
    - $15 DS9097U-009 or -S09 + DS1402D-DR8l for the serial interface
      Note:  The DS9097, DS9097E, or parallel port adaptors will not work with mh
    -  $3 DS1990A-F5  for 64 bit ID buttons.
</PRE>
<PRE>

  <A HREF="http://www.pointsix.com">http://www.pointsix.com</A>
    - They also sell the $15 interface (under iButton Products) 
    - $10 for a 1 port relay card
    - $10 for a 2 port digital input or ouptut card
    - $6  for a 1820 temperature sensor
    - Info on how to wire up a 1 wire bus: 
      <A HREF="http://www.pointsix.com/cgi-bin/PointSix.cgi?AppNotes&amp">http://www.pointsix.com/cgi-bin/PointSix.cgi?AppNotes&amp</A>;app010</PRE>
<PRE>
  <A HREF="http://www.aag.com.mx">http://www.aag.com.mx</A>
    - Sell an ibutton weather station for $80</PRE>
<PRE>
  <A HREF="http://weather.henriksens.net">http://weather.henriksens.net</A>  has free 1-Wire Weather station software
    - It includes a tcp/ip server that (in theory) could talk to mh</PRE>
<PRE>
  Ray Dzek has a nice how to get started tutorial here:
    <A HREF="http://www.solarbugs.com/home/ibutton.htm">http://www.solarbugs.com/home/ibutton.htm</A></PRE>
<P>If you want more reliable VR without having to use a headset, you can try these to digital array microphones:</P>
<PRE>
 - Labtec LVA-7280 ClearVoice Digital Microphone ($130)
   <A HREF="http://www.labtec.com/product/family.cfm?CategoryID=2">http://www.labtec.com/product/family.cfm?CategoryID=2</A></PRE>
<PRE>
 - Andrea Desktop array DA-400 ($150)
   <A HREF="http://www.andreaelectronics.com">http://www.andreaelectronics.com</A></PRE>
<P>The Labtec has a push button on top to
turn it on and off and a red/green LED that blinks green when sound is
heard.   The Andrea has a slide switch on the side to turn it on and off.
The Andrea has a bit clearer sound and is about 2/3 the size.
Having a hardware switch to disable VR is handy.</P>
<P>Both of these mikes are ment to be used when you are at the desktop.
The idea is that they filter out background noise better, so you can use them in
slightly noise environments, where headsets were normally required.</P>
<P>Can process data from a keyboard simulator scanner, like the Cue Cat</P>
<P>The mh/code/test/barcode* members code will process data from the Cue Kat keyboard simulator
barcode scanner, which you can pick up for free at Radio Shack.  The manufacture of the Cue Kat
prefers that you use their software (thats why they give it away), and if you want to look up data
on the web for an item, their software is probably best, as they have a large databse of UPC codes.
If, however, you want to use the scanner
for some sort of home inventory purpose, their software does not do that.  The problem is that if 
you use their software, you must agree to a Licence that says you will only use the scanner with their
software.  Hopefully they will not notice or care that small group of us HA guys are using it
without their software (other people who have written similar code have gotten cease-and-desist letters).</P>
Info on an LCD internet appliances that makes an affordable touch screen controlers in 
the MisterHouse Internet Appliance FAQ here:
<a href="faq_ia.html">mh/docs/ia.html</a><P>
<H2><A NAME="list of startup options">List of startup options</A></H2>
<P>The complete list of valid startup options is in the mh.ini file.  Here are a few of the more
important ones and their defaults:</P>
<DL>
<DT><STRONG><A NAME="item_code_dir%3D%5Cmh%5Ccode%5Ctest">code_dir=\mh\code\test</A></STRONG><BR>
<DD>
Points to the directory that has the user code files in it.
<P></P>
<DT><STRONG><A NAME="item_html_root%3D%24Pgm_Root%2Fweb">html_root=$Pgm_Root/web</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_html_file%3Dmh_default%2Findex%2Ehtml">html_file=mh_default/index.html</A></STRONG><BR>
<DD>
Points to where the web interface html files are.
<P></P>
<DT><STRONG><A NAME="item_http_port%3D8080">http_port=8080</A></STRONG><BR>
<DD>
Use 80 if you want to use the normal web port (i.e. <A HREF="http://localhost">http://localhost</A> ).
If using something other than 80 (because you already have a web server 
running), add :port to url (e.g.  <A HREF="http://localhost:8080">http://localhost:8080</A> ).
<P></P>
<DT><STRONG><A NAME="item_server_telnet_port%3D23">server_telnet_port=23</A></STRONG><BR>
<DD>
Use 23 to enable access via 'telnet localhost', if you are running the mh/code/testtelnet.pl member.
If you use a different port, you can still get to the port with 'telnet localhost port_number'.
<P></P>
<DT><STRONG><A NAME="item_diagnostics%3D1">diagnostics=1</A></STRONG><BR>
<DD>
Set this (or w=1) to enable perl -w warning messages on potential code errors. 
mh runs about 10% slower with this option on.
<P></P>
<DT><STRONG><A NAME="item_run%3Dperl_script">run=perl_script</A></STRONG><BR>
<DD>
This parms allow the compile mh.exe to act as a general purpose perl interpreter, so we can run any 
arbitrary perl script, without having to have perl installed.   See the get_weather.bat, get_tv_grid.bat,
or set_clock.bat files for examples.   This also allows is to use the mh run command to spawn a separate
mh process to run longer running perl steps, even if we do not have perl installed.  A Win32 'fork' command
would be cleaner, but alas, no forks.
<P></P>
<P></P>
<DT><STRONG><A NAME="item_debug%3D">debug=</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_log%3D">log=</A></STRONG><BR>
<DD>
You can use the -debug and -log and options to turn on debug and/or log the console errata to a file.
For example:
<PRE>
  mh -debug http -log http_socket.log</PRE>
<P>will turn on socket related debug messages and log all errata to the file http_socket.log</P>
<P></P>
<P></P>
<DT><STRONG><A NAME="item_time_start%3D">time_start=</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_time_stop%3D">time_stop=</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_time_increment%3D">time_increment=</A></STRONG><BR>
<DD>
Use time_start and time_stop to run mh in 'fast test mode', useful for debugging events.
The time_increment parm sets how many simulated seconds to increment per pass.  Default is 60.
If only time_start is specified, normal mode will resume
when the current time is reached.  If time_stop is specified, mh will exit when reached.
These parameters can be any time/date string, as recognized by the time_now function (see docs)
<P>Here are some examples:</P>
<PRE>
  mh -time_start 0 -time_stop 24 -tk 0 -voice_text 0
  mh -time_start &quot;6 AM&quot; -time_stop &quot;11 PM&quot;  -time_increment 1
  mh -time_start &quot;5/14 7:10&quot; -time_stop &quot;5/15 10 PM&quot; -time_increment 300</PRE>
<P></P></DL>
<P>
<H2><A NAME="list of global variables">List of global variables</A></H2>
<P>Time/Date Variables</P>
<PRE>
  $Time_Startup, $Time_Startup_time, $Time_Now, $Date_Now, $Year_Month_Now
  $Time_Sunrise, $Time_Sunset, $Time_Sunrise_Twilight, $Time_Sunset_Twilight
  $Second, $Minute, $Hour, $Mday, $Wday, $Day, $Month, $Year, $Holiday
  $New_Msecond_100, $New_Msecond_250, $New_Msecond_500, $New_Second, $New_Minute,
  $New_Hour, $New_Day, $New_Month, $New_Year
  $Season, $Weekday, $Weekend, $Time_Of_Day, $Dark
  %Moon</PRE>
<P>The complete list of global variables can be found on the Widgets menu of the default web page
or at the top of mh/bin/mh.</P>
<P>The %Moon array has 
$Moon{phase}, $Moon{brightness}, $Moon{age}, and $Moon{new,first,full,last} entries.</P>
<P>The $Time_Now and $Date_Now variables return a formated time and date.</P>
<P>The $New_* variables are true only on the pass that we enter a new Second, Minute, Hour, etc.
$New_Msecond_100/250 are true every .1 and .25 seconds.
There are also new_* functions if you want to test on every nth second/minute/hour (see new_second function).</P>
<P>$Startup is true on the first pass after starting mh.</P>
<P>$Reload is true when the <CODE>Reload(F1)</CODE> is requested AND the code been reloaded because one or more code members
have been changed.</P>
<P>$Reread is always true after Reload(F1), even if no code members have changed.</P>
<P>$Keyboard echos characters typed on the keyboard (currently windows only)</P>
<P>
<H2><A NAME="list of objects and their methods">List of objects and their methods</A></H2>
<DL>
<DT><STRONG><A NAME="item_File_Item">File_Item</A></STRONG><BR>
<DD>
You can use File_Item to read a line of data from a file. 
Note:  These methods currently read the entire file, so if have big files (say, &gt;1 meg) we want to read, we should invent some new methods.
<PRE>
  Methods:
     new('file_name')</PRE>
<PRE>
     name         : Returns 'file_name'</PRE>
<PRE>
     read_all     : Returns contents for the file. If used in a list context,
                    a list is returned, otherwise a string of all the lines.</PRE>
<PRE>
     read_head    : Returns the first few lines of a file.  See file_head.
     read_tail    : Returns the last  few lines of a file.  See file_tail.</PRE>
<PRE>
     read_random  : Reads a random record. 
                    This also re-sets the index to the random position.</PRE>
<PRE>
     read_next    : Reads the next record, according to the index.
     read_current : Reads the current record, according to the index.</PRE>
<PRE>
     index        : Which record was last read.  A couple of notes:
                      - The index is saved between mh sessions.
                      - If you use a File_Item that does not yet have 
                        an index set, a random index will be used and stored.
     set_index    : Set the index.</PRE>
<PRE>
     set_watch('flag') : Sets the 'changed' time check.</PRE>
<PRE>
     changed      : Returns 0 if the file was not changed since a set_watch call.
                    When the file changes:
                     - If 'flag' was specified in the new method, 'flag' is returned.
                     - Otherwise, it returns the number of seconds since a set_watch call.</PRE>
<PRE>
     said         : Returns data added to a file since the last call.
                    Only one record is returned per call.
                    This is useful for monitoring log files.
                    See mh/code/bruce/shoutcast.pl  for an example.</PRE>
<PRE>
  Examples:
     $f_deep_thoughts = new File_Item(&quot;$Pgm_Root/data/remarks/deep_thoughts.txt&quot;);
     my $thought = read_next $f_deep_thoughts;
     set_index $f_deep_thoughts 1;</PRE>
<PRE>
     $f_weather_forecast = new File_Item(&quot;$Pgm_Root/data/web/weather_forecast.txt&quot;);
     set_watch $f_weather_forecast;
     display name $f_weather_forecast if changed $f_weather_forecast;</PRE>
<PRE>
     $shoutcast_log = new File_Item 'd:/shoutcast/sc_serv.log';  
     print &quot;Log data: $state&quot; if $New_Second and $state = said $shoutcast_log;</PRE>
<P></P>
<DT><STRONG><A NAME="item_Generic_Item">Generic_Item</A></STRONG><BR>
<DD>
You can use this object to store and query arbitrary data.  This is more useful than 'my' variables, if you need to share data between
code files, since 'my' variables are local to a code file.  States of these items are also saved/restored when
mh is stopped/started.
<P>All other items that have states (e.g. X10_Item, Serial_Item, iButton, Voice_Cmd, Group) inherit all Generic_Item methods.</P>
<PRE>
  Methods:
     new
     state        :
     state_now    :
     set          :</PRE>
<PRE>
     hidden(1/0)         : If set to 1, the object will not show up on Tk or Web menus.</PRE>
<PRE>
     tie_items($item)    : If the state of the generic_item changes, then 
                           the state of $item will be set to that same state
     untie_items($item)  : Untie $item</PRE>
<PRE>
     tie_events($code)   : It the state of the generic_item changes, then
                           Code string $code will trigger, with the variable
                           $state getting expanded.
     untie_items($code)  : Untie $code</PRE>
<PRE>
     tie_filter($filter) : Use this to disable control of the item whenever
                           $filter returns true.  
     untie_filter($filter):Untie $filter</PRE>
<PRE>
     tie_time($time,$state): Sets item to $state if the $time string evaluates true.
                           $time can be in either time_cron or time_now format.
     untie_time($time)   : Untie $time</PRE>
<PRE>
     get_chaged_by       : Returns which tied object caused this objects state to change.</PRE>
<PRE>
     set_states(@states) : Sets valid states to @states
     add_states(@states) : Adds @states to the list of valid states
     get_states          : Returns the list of valid states</PRE>
<PRE>
     restore_data(@vars) : Specifies which variables should be saved/restored between
                           mh reload/restarts.  The state var is always saved.</PRE>
<PRE>
     set_authority('anyone') : Bypasses password control</PRE>
<PRE>
     set_icon : Point to the icon member you want the web interface to use.
                See the 'Customizing the web interface' section of this document for details.</PRE>
<PRE>
     set_info : Adds additional information.  This will show up as a popup window
                on the web interface, when the mouse hovers over the command text.</PRE>
<PRE>
     set_label: Specify a text label, useful for creating touch screen interfaces.</PRE>
<P>The tie/untie methods can be done conditionally, so you can change what is tied to what on the fly.
If you do this, however, you need to also make sure you also make the tie* method call 
on $Reload, as the objects tie items/events are currently not stored between reloads.</P>
<P>The tie_* methods can also take 2 optional arguments.  The first is the state you want the 
tie to apply to.  If not specified, it defaults to all states.  This is required for tie_time.</P>
<P>The 2nd optional tie_* argument is a print_log message you want whenever the tie_ event triggers.</P>
<PRE>
  Examples:
     $tv_grid = new Generic_Item;
     set $tv_grid 'channel 2 from 7:00 to 8:00 on 1/24 for This Old House';
     speak &quot;tv set to $state&quot; if $state = state_now $tv_grid;</PRE>
<PRE>
     $wakeup_time = new Generic_Item;
     speak &quot;Your wakeup time is set for $state&quot; if $state = state_now $wakeup_time;
     speak &quot;Time to wake up&quot; if time_now state $wakeup_time;</PRE>
<PRE>
   # Since Voice_Cmd objects inherit Generic_Items methods, we can 
   # use tie_items and tie_event like this:</PRE>
<PRE>
     $indoor_fountain    = new X10_Appliance('OB');
     $v_indoor_fountain  = new Voice_Cmd 'Indoor fountain [on,off]';
     $v_indoor_fountain -&gt; tie_items($indoor_fountain);
     $v_indoor_fountain -&gt; tie_event('speak &quot;Ok, fountain was turned $state&quot;');</PRE>
<PRE>
     if ($state = state_now $test_button) {
        my $ref = get_changed_by $test_button;
        print_log &quot;Test button's was set to $state by $ref-&gt;{object_name}&quot; if $ref;
     }</PRE>
<PRE>
                           # This shows how to set states
    $TV  = new IR_Item 'TV';
    my  $tv_states = 'power,on,off,mute,vol+,vol-,ch+,ch-';
    set_states  $TV split ',', $tv_states;
    $v_tv_control = new  Voice_Cmd(&quot;tv [$tv_states]&quot;);</PRE>
<PRE>
                           # This shows how to save persistant arbitrary data
    $Test = new Generic_Item;
    $Test-&gt;{junk_data1} = $Time_Now if $Reload;
    $Test-&gt;{junk_data2} = $Month    if $Reload;
    $Test-&gt;restore_data('junk_data1', 'junk_data2');</PRE>
<PRE>
                           # Here are some tie* examples
    $fountain -&gt; tie_filter('state $windy eq ON', ON,
                            'Overriding item1 ON command because of wind');</PRE>
<PRE>
    $fountain -&gt; tie_time('10PM', OFF, 'Fountain turned off');</PRE>
<P>See mh/code/examples/generic_item.pl for more examples.
See mh/code/examples/test_tie.pl for more examples on how to tie/untie items/events.</P>
<P></P>
<DT><STRONG><A NAME="item_Group">Group</A></STRONG><BR>
<DD>
You can use this object to group and operate on groups of items:
<PRE>
  Methods:
     new(@item_list)
     add(@item_list)
     set  
     state        : Returns the last state that the group was set to
     state_log    : Returns a list array of the last max_state_log_entries (mh.ini parm)
                    time_date stamped states.</PRE>
<PRE>
  Examples:
     $outside_lights = new Group($light1, $light2, $light3);
     $outside_lights-&gt; add($light4, $light5);
     $outside_lights-&gt; add($light6);
     set $outside_lights ON if time_now(&quot;$Time_Sunset + 0:15&quot;);</PRE>
<P>See mh/code/examples/test_group.pl for more examples.</P>
<P></P>
<DT><STRONG><A NAME="item_iButton_Item">iButton_Item</A></STRONG><BR>
<DD>
This is used to query and/or control an iButton device (for more info on iButton, see the hardware section).
To enable ibutton support in mh, set the mh.ini parm ibutton_port.
<PRE>
  Methods:
     new $id, $port
       If $port is not specified, the port of the first iButton::connect
       will be used.</PRE>
<PRE>
     set $state   : Sets the item to the specified state.</PRE>
<PRE>
     state        : Returns the last state that was received or sent</PRE>
<PRE>
     state_now    : Returns the state that was received or sent in the current pass.</PRE>
<PRE>
     state_log    : Returns a list array of the last max_state_log_entries (mh.ini parm)
                    time_date stamped states.</PRE>
<PRE>
     read_temp    : Returns the temperature of temperature devices.</PRE>
<P>In addition to the above, all of the methods provided by the Hardware/iButton/Device.pm 
module are available (documented in mh/lib/site/Hardware/iButton/Device.pm).</P>
<P>These functions are also part of the iButton module, but not associated with an object:</P>
<PRE>
     scan        $family, $port : Returns a object list of iButton devices that match $family 
     scan_report $family, $port : Returns a report of      iButton devices that match $family</PRE>
<PRE>
     monitor $family, $port : Checks the one wire bus for iButton activity</PRE>
<PRE>
     connect $port       : Connect to the one wire bus.  Note you can now have multiple
                           iButton interfaces on multiple COM ports.</PRE>
<PRE>
     disconnect          : Disconnect to the one wire bus</PRE>
<P>Note, all of these functions take an optional $port parm (required for connect).
If not specified, the port of the first connect record will be used.</P>
<P>The $id required when creating new iButton_Item is the 16 hex character (64 bit) iButton id that
is unique to every device.  This is often printed on the larger devices.  If not, you can use:</P>
<PRE>
    $v_iButton_list      = new Voice_Cmd &quot;List all the iButton buttons&quot;;
    print_log &amp;iButton::scan_report if said $v_iButton_list;</PRE>
<P>The last 2 characters are CRC bits and are optional.  If missing (i.e. you only specify 
the first 14 characters), mh will calculate it.
</P>
<PRE>

The first 2 characters are the iButton family type.  Here is a list of family types:</PRE>
<PRE>
     Field Index:
      ------------
      (1) Family code in hex
      (2) Number of regular memory pages
      (3) Length of regular memory page in bytes
      (4) Number of status memory pages
      (5) Length of status memory page in bytes
      (6) Max communication speed (0 regular, 1 Overdrive)
      (7) Memory type (see below)
      (8) Part number in iButton package
      (9) Part number in non-iButton package
      (10) Brief descriptions
</PRE>
<PRE>

      (1)   (2)  (3)  (4)  (5)  (6)  (7)   (8)   (9)   (10)
      -------------------------------------------------------
      01,    0,   0,   0,   0,   1,   0, DS1990A,DS2401,Unique Serial Number
      02,    0,   0,   0,   0,   0,   0, DS1991,DS1205, MultiKey iButton
      04,   16,  32,   0,   0,   0,   1, DS1994,DS2404,4K-bit NVRAM with Clock
      05,    0,   0,   0,   0,   0,   0, DS2405,,Single Addressable Switch
      06,   16,  32,   0,   0,   0,   1, DS1993,DS2403,4K-bit NVRAM
      08,    4,  32,   0,   0,   0,   1, DS1992,DS2402,1K-bit NVRAM
      09,    4,  32,   1,   8,   1,   2, DS1982,DS2502,1K-bit EPROM
      0A,   64,  32,   0,   0,   1,   1, DS1995,DS2416,16K-bit NVRAM
      0B,   64,  32,  40,   8,   1,   3, DS1985,DS2505,16K-bit EPROM
      0C,  256,  32,   0,   0,   1,   1, DS1996,DS2464,64K-bit NVRAM
      0F,  256,  32,  64,   8,   1,   3, DS1986,DS2506,64K-bit EPROM
      10,    0,   0,   0,   0,   0,   0, DS1920,DS1820,Temperature iButton with Trips
      11,    2,  32,   1,   8,   0,   2, DS1981,DS2501,512-bit EPROM
      12,    4,  32,   1,   8,   0,   4, DS2407,,Dual Addressable Switch
      13,   16,  32,  34,   8,   0,   3, DS1983,DS2503,4K-bit EPROM
      14,    1,  32,   0,   0,   0,   5, DS1971,DS2430A,256-bit EEPROM, plus
      64-bit
      OTP
      15,    0,   0,   0,   0,   1,   0, DS87C900,,Lock Processor
      16,    0,   0,   0,   0,   0,   0, DS1954,,Crypto iButton
      18,    4,  32,   0,   0,   1,   6, DS1963S,4K-bit Transaction iButton with
      SHA
      1A,   16,  32,   0,   0,   1,   6, DS1963,,4K-bit Transaction iButton
      1C,    4,  32,   0,   0,   1,   6, DS2422,,1K-bit EconoRAM with Counter
      Input
      1D,   16,  32,   0,   0,   1,   6, DS2423,,4K-bit EconoRAM with Counter
      Input
      1F,    0,  32,   0,   0,   0,   0, DS2409,,One-Wire Net Coupler
      20,    3,   8,   0,   0,   1,   9, DS2450,,Quad A-D Converter
      21,   16,  32,   0,   0,   1,   8, DS1921,,Temperature Recorder iButton
      23,   16,  32,   0,   0,   1,   7, DS1973,DS2433,4K-bit EEPROM
      22                                 DS1822 temperature button   
      40,   16,  32,   0,   0,   0,   1, DS1608,,Battery Pack Clock</PRE>
<PRE>
  Examples:</PRE>
<PRE>
    $v_iButton_connect = new Voice_Cmd &quot;[Connect,Disconnect] to the iButton bus&quot;;
    if ($state = said $v_iButton_connect) {
      if ($state eq 'Connect') {
        print_log &amp;iButton::connect($config_parms{iButton_serial_port});
        print_log &amp;iButton::connect($config_parms{iButton_2_serial_port});
      }
      else {
        print_log &amp;iButton::disconnect;
        print_log &amp;iButton::disconnect, $config_parms{iButton_2_serial_port};
      }
    }</PRE>
<PRE>
    $ib_bruce  = new iButton '010000012345ef';
    speak 'Hi Bruce'  if ON  eq state_now $ib_bruce;
    speak 'Later'     if OFF eq state_now $ib_bruce;</PRE>
<PRE>
    $ib_relay1 = new iButton '12000000123456ff', $config_parms{iButton_2_serial_port};
    $v_iButton_relay1    = new Voice_Cmd &quot;Turn relay1 [on,off]&quot;;
    if ($state = said $v_iButton_relay1) {
       print_log &quot;Setting iButton relay1 to $state&quot;;
       set $ib_relay1 $state;
    }</PRE>
<PRE>
    $ib_temp1  = new iButton '1000000029a14f';
    $ib_temp2  = new iButton '1000000029f5d6';
    my @ib_temps = ($ib_temp1, $ib_temp2);</PRE>
<PRE>
    $v_iButton_readtemp  = new Voice_Cmd &quot;Read the iButton temperature [1,2]&quot;;
    if ($state = said $v_iButton_readtemp) {
       my $b = $ib_temps[$state-1];
       my $temp = read_temp $b;
       print_log &quot;Temp for sensor $state: $temp F&quot;;
       logit(&quot;$config_parms{data_dir}/iButton_temps.log&quot;,  &quot;$state: $temp&quot;);
    }
    if ($New_Second and !($Minute % 5)) {
       run_voice_cmd 'Read the iButton temperature 1' if $Second == 11;
       run_voice_cmd 'Read the iButton temperature 2' if $Second == 22;
    }</PRE>
<P></P>
<DT><STRONG><A NAME="item_IR_Item">IR_Item</A></STRONG><BR>
<DD>
This object controls IR transmiters.  Currently only the X10 IR Commander 
(http://www.x10.com/products/ux17a_bj2.htm) 
is supported.  The X10 IR Commander receives commands from the wireless CM17 (firecracker) interface.
<P>Currently, you must use the X10 supplied software 
(http://www.x10.com/commander.htm and/or <A HREF="ftp://ftp.x10.com/pub/applications/commander/)">ftp://ftp.x10.com/pub/applications/commander/)</A>
to program the IR Commander to 
use the codes for your various remotes.</P>
<PRE>
  Methods:
     new $type, $code : Creates a new Item.  
        Here are the valid types:
           TV, VCR, CAB, CD, SAT, DVD
        Currently, $code can be any of he following:
           2digit  : this is the default if $code is not specified
           3digit  : 3 digits are transmited for channels
           addEnter: adds an ENTER command after any numbers, to make 
                     changing channels faster on devices that wait for a
                     timeout (e.g. Ocelot).</PRE>
<PRE>
     state        : Returns the last state that was sent
     state_now    : Returns the state that was sent in the current pass.
     state_log    : Returns a list array of the last max_state_log_entries (mh.ini parm)
                    time_date stamped states.</PRE>
<PRE>
     set $command : Sends out commands to the IR device.  Here is a list of valid commands:
                    Note:  Commands are case insensitive</PRE>
<PRE>
        POWER      MUTE      
        CH+        CH-      
        VOL+       VOL-     
        1          2        
        3          4        
        5          6        
        7          8        
        9          0        
        MENU       ENTER    
        FF         REW      
        RECORD     PAUSE     
        PLAY       STOP     
        AVSWITCH   DISPLAY  
        UP         DOWN      
        LEFT       RIGHT    
        SKIPDOWN   SKIPUP   
        TITLE      SUBTITLE 
        EXIT       OK       
        RETURN</PRE>
<PRE>
  Examples:</PRE>
<PRE>
    $TV = new IR_Item 'TV';
    $v_tv_control = new  Voice_Cmd(&quot;tv [power,on,off,mute,vol+,vol-,ch+,ch-]&quot;);
    set $TV $state if $state = said $v_tv_control;</PRE>
<PRE>
    $VCR = new IR_Item 'vcr', '3digit';
    set $VCR &quot;12,RECORD&quot; if time_cron('59 19 * * 3');
    set $VCR &quot;STOP&quot;      if time_cron('00 20 * * 3');</PRE>
<P></P>
<DT><STRONG><A NAME="item_LCD">LCD</A></STRONG><BR>
<DD>
This object is used to send and receive data to LCD type displays with keypads.
An example is in mh/code/bruce/lcd.pl.
To use simulate an LCD keypad with your pc keyboard, use mh/code/test/lcd_keyboard.pl.
<PRE>
  Methods:
     new $type, $port, $size, $menu_group, $keymap
</PRE>
<PRE>

       $type:  Either lcdproc or keyboard.  
       $port:  The ip:port of where lcdproc is running.
       $size:  ROWSxCOLUMNS of the LCD display.
       $menu_group:  The menu parsed by menu_parse (see Menu section of this doc).
       $keymap: A has that translates keys to usable names.</PRE>
<PRE>
     start        =&gt; Connect to the LCD.  Automatically called on startup
     stop         =&gt; Disconnect the LCD.
     load $menu   =&gt; Load menu $menu.  Default menu is the first one.
     check_key    =&gt; Returns whatever key is keyed in
     set @data    =&gt; Sends @data to the LCD, one line per list element
     set_key $key =&gt; Simulates the keyboard being pressed with $key
     inactive     =&gt; Returns true if no key has been pressed in 10 seconds.</PRE>
<PRE>
  Examples:</PRE>
<PRE>
     my %lcd_keymap1 = ( N =&gt; 'up', I =&gt; 'down', M =&gt; 'left', H =&gt; 'right',
                         F =&gt; 'exit', K =&gt; 'enter', L =&gt; 'left', G =&gt; 'right');
     my %lcd_keymap2 = ( 38=&gt; 'up', 40=&gt; 'down', 37=&gt; 'left', 
                         39=&gt; 'right', 17=&gt; 'exit', 96=&gt; 'enter') ;</PRE>
<PRE>
    $lcd1 = new LCD  'lcdproc', '192.168.0.5:13666', '4x20', 'default', \%lcd_keymap1;
    $lcd2 = new LCD 'keyboard',               undef, '4x20', 'mh',      \%lcd_keymap2;</PRE>
<P></P>
<DT><STRONG><A NAME="item_Process_Item">Process_Item</A></STRONG><BR>
<DD>
You can use this object to run external programs.  On Win32 systems, the Win32::Process function is used. 
On Unix systems, the fork function is used.  On either system, the following methods work in the same way:
<PRE>
  Methods:
     new('program1 arguments', 'program2 arguments', ...)
     set('program1 arguments', 'program2 arguments', ...)
     add('program3 arguments', 'program4 arguments', ...)</PRE>
<PRE>
        If you specify more than one program, they are run sequentially.  done_now returns
        1 after the last program is done.</PRE>
<PRE>
        If program starts with &amp;, then 'program arguments' is eval-ed as an internal mh function.
        Otherwise, 'program arguments' is run as an external command.</PRE>
<PRE>
        On Windows, the &amp;-&gt; eval trick is supposed to work with perl 5.6+ (which has fork), but
        unfortunatly, it causes perl to crash often, so is probably not useful yet.</PRE>
<PRE>
     set_output $output_file : Program errata goes to $output_file</PRE>
<PRE>
     start          : Starts the process.</PRE>
<PRE>
     stop           : Stops the process.
                      If not process is specified, all active Process_Items are stopped.</PRE>
<PRE>
     done           : Returns the time (seconds since epoch) that the process finished.  If
                      the process has been started, but has not yet finished, it returns 0.</PRE>
<PRE>
     done_now       : Is true for the pass that the process finished on.</PRE>
<PRE>
  Examples:
     my $slashdot_news = &quot;$Pgm_Root/data/web/slashdot_news.txt&quot;;
     $p_slashdot_news = new Process_Item(&quot;get_slashdot_news &gt; $slashdot_news&quot;);
     start $p_slashdot_news if time_now('6:30 AM');
     display $slashdot_news if done_now $p_slashdot_news;</PRE>
<PRE>
     $p_report_weblog = new Process_Item;
     $p_report_weblog -&gt;set_output(&quot;$config_parms{data_dir}/weblog_results.txt&quot;);
     if (time_now '2 AM') {
         set   $p_report_weblog &quot;report_weblog /mh/data/logs/server.$Year_Month_Now.log&quot;;
         start $p_report_weblog;
     }</PRE>
<PRE>
                    # Example of multiple commands
     $test_process1 = new Process_Item;
     set $test_process1 'sleep 1', 'sleep 2';
     add $test_process1 'sleep 1';</PRE>
<PRE>
                    # Example of running an internal mh subroutine
    $v_test_ftp = new Voice_Cmd 'Test background ftp [get,put]';
    $p_test_ftp = new Process_Item;
    if ($state = said $v_test_ftp) {
      set $p_test_ftp &quot;&amp;main::net_ftp(file =&gt; '/tmp/junk1.txt', &quot; .
                      &quot;file_remote =&gt; 'incoming/junk1.txt',&quot; . 
                      &quot;command =&gt; '$state')&quot;;
      start $p_test_ftpb;
    }
    print_log &quot;Ftp command done&quot; if done_now $p_test_ftp;</PRE>
<P></P>
<DT><STRONG><A NAME="item_Serial_Item">Serial_Item</A></STRONG><BR>
<DD>
Serial_Item is used whenever you want read or write serial port data.
<PRE>
  Methods:
     new('data_stream', 'state_name', 'serial_port')
     add('data_stream', 'state_name')</PRE>
<PRE>
        If 'serial_port' is not specified, then:
           For outgoing X10 data, the first valid port from this list is used:
               cm11, cm17, homevision, homebase, weeder, serial1, serial2, ...
           For other outgoing data, the first valid port from this list is used:
               weeder, serial1, serial2, ...</PRE>
<PRE>
           For incoming data, the 'serial_port' parm is not important, as 
           data from the cm11, homebase, and weeder ports is processed in the same way.</PRE>
<PRE>
           For the generic ports (serial1, serial2, ...), incoming data is processed
           only by user specified 'said' methods.</PRE>
<PRE>
     state        : Returns the last state that was received or sent</PRE>
<PRE>
     state_now    : Returns the state that was received or sent in the current pass.
                    Note that the a 'set' will trigger a state_now one the next pass.</PRE>
<PRE>
     state_log    : Returns a list array of the last max_state_log_entries (mh.ini parm)
                    time_date stamped states.</PRE>
<PRE>
     set_dtr      : Sets/resets the DTR line
     set_rcs      : Sets/resets the RCS line.  For example:</PRE>
<PRE>
                      set_dtr $port 1;
                      set_rcs $port 0;</PRE>
<PRE>
     set          : Sets the item to the specified state.
                     - If the specified state has not been defined with 'new' or 'add', 
                       the state data is sent.  Otherwise the data_stream associated
                       with that state is sent.</PRE>
<PRE>
     set_data     : Use this to put data back into the serial read buffer.  Typically used
                    when you have processed only some of the serial data, and you want to 
                    put the rest back because it is incomplete.  Here is an example:</PRE>
<PRE>
                   if (my $data = said $wx200_port) {
                      my $remainder = &amp;read_wx200($data, \%weather);
                      set_data $wx200_port $remainder if $remainder;
                   }</PRE>
<PRE>
     said         : Returns a data record received by the port.  
                     - Characters are spooled into one record until a '\n' (newline) is
                       received.  Only then does 'said $item' become valid, and it is
                       reset as soon as the said method is executed.</PRE>
<PRE>
                     - Note: If you want to process binary serial data, specify 
                             serial#_datatype=raw in the mh.ini file.  This
                             will cause said to return any data read immediately, 
                             rather than buffering up data until a newline is read.</PRE>
<PRE>
     start        : Re-starts the serial port after a stop command or after starting 
                    with the port already in use.</PRE>
<PRE>
     stop         : Stops using the serial port for this item.  That allows other programs
                    to share the port (e.g. let mh use the modem for caller ID, but turn
                    that function off when using the modem to call out).</PRE>
<PRE>
     is_stopped   : True if the port is not active
     is_available : True if the port is not in used by another program</PRE>
<PRE>
     set_icon : Point to the icon member you want the web interface to use.
                See the 'Customizing the web interface' section of this document for details.</PRE>
<PRE>
     set_info : Adds additional information.  This will show up as a popup window
                on the web interface, when the mouse hovers over the command text.</PRE>
<PRE>
     set_order: Contols the order that the commands are listed in web Category list.
                The default is alphabetically by file, then by name.</PRE>
<P>will show up as a popup window
                on the web interface, when the mouse hovers over the command text.</P>
<PRE>
  Examples:
     $garage_movement = new Serial_Item('XI2');
     speak &quot;Someone is in the garage&quot; if state_now $garage_movement;</PRE>
<PRE>
     $tnc_output = new Serial_Item ('CONV', 'converse', 'serial1');
     $tnc_output -&gt; add            ('?WX?', 'wxquery');
     set $tnc_output 'converse';
     set $tnc_output &quot;EMAIL    :userid\@computers.com Test E-Mail - $CurrentTemp deg.{0&quot;;
     my $serial_data = said $tnc_output;</PRE>
<PRE>
     $v_tnc_close = new  Voice_Cmd(&quot;close the tnc serial port&quot;);
     stop  $tnc_output if said $v_tnc_close;
     start $tnc_output if $New_Minute and is_stopped $tnc_output
                          and is_available $tnc_output;</PRE>
<P>See mh/code/examples/serial_port_examples.pl for more Serial_Item examples.</P>
<P></P>
<DT><STRONG><A NAME="item_Weather_Item">Weather_Item</A></STRONG><BR>
<DD>
This object can be used to track data stored in the global %Weather array.
<PRE>
  Methods:
     new $type
        $type is the name of the %Weather index you want to monitor</PRE>
<PRE>
        $type can also have a =&lt;&gt; comparision operator in it so 
        you can make the object a true/false test.</PRE>
<PRE>
     state        : Returns the last state, or 1/0 if $comparition and $limit were used.
     state_now    : Returns the state only when the weather data changed.</PRE>
<PRE>
     It also inherits the Generic_Item methods.</PRE>
<PRE>
  Examples:</PRE>
<PRE>
   $WindSpeed = new Weather_Item 'WindSpeed';
   $WindSpeed-&gt; tie_event('print_log &quot;Wind speed is now at $state&quot;');</PRE>
<PRE>
   $freezing = new Weather_Item 'TempOutdoor &lt; 32';
   if (state_now $fountain eq ON and state $freezing) {
     speak &quot;Sorry fountains don't work too well when frozen&quot;;
     set $fountain OFF
   }</PRE>
<PRE>
   $Windy = new Weather_Item 'WindSpeed &gt; 15';
   speak &quot;Wind is gusting at $Weather{WindSpeed} mph&quot; if state $Windy;</PRE>
<PRE>
                  # For current state, easiest to use it directly
   speak &quot;Outdoor temperature is $Weather{TempOutdoor} degrees&quot;;</PRE>
<P>For examples on interface code that stores data into %Weather,
see mh/code/bruce/weather_monitor.pl (uses mh/lib/Weather_wx200.pm),
mh/code/public/iButton_ws_client.pl, 
and mh/code/public/weather_com.pl</P>
<P></P>
<DT><STRONG><A NAME="item_X10_Item">X10_Item</A></STRONG><BR>
<DD>
Same as Serial_Item, except the 'X' prefix is prepended, to indicate an X10 command,  and it has pre-defined states
'on', 'off'. 'brighten', 'dim', and '+5'-&gt;'+95 and '-5'-&gt;'-95'.  The +-## states increase/decrease brightness by 
## percent.
<P>You can specify a 2nd argument, if you are using more than one X10 interface and you want to 
control an X10_Item with a specific interface.  For example, if you want to control the 
local module on a RF Transeiver, you can tell mh to use the RF CM17 interface, like this:</P>
<PRE>
    $test_light = new X10_Item('A1', 'CM17');</PRE>
<P>Note that the X10 device code is numbered 1-&gt;9,A-&gt;G.  For example device 16 in house code P would be PG.</P>
<P>If a single character is use (e.g. X10_Item 'D'), then 'on' and 'off' states are translated to
ALL_ON and ALL_OFF commands for that house code.  For example:</P>
<PRE>
   $v_test_lights = new Voice_Cmd 'All lights [on,off]';
   $test_lights   = new X10_Item 'O';
   set $test_lights $state if $state = said $v_test_lights;</PRE>
<P>This item also has a built in timer with the set_with_timer method.  For example,
this event will turn on a on a warning light to 20% for 5 seconds:</P>
<PRE>
   set_with_timer $watchdog_light '20%', 5 if file_unchanged $watchdog_file;</PRE>
<P>After doing one or more bright/dim/on/off commands, you can query the current brightness level 
of a device with the level method.  For example:</P>
<PRE>
   if ($state = state_now $pedestal_light) {
      my $level = level $pedestal_light;
      print_log &quot;Pedestal light state=$state, level=$level&quot;
   }</PRE>
<P>If you have one of the newer (more expensive) LM14A/PLM21 2 way X10 pro lamp modules, you can 
tell mh to send an extended X10 codes that let them be set directly to a specific brightness level
using a Preset Dim extended code.
The older modules can only be brightened/dimed.</P>
<P>The 64 extened X10 Preset Dim codes can used most easily by using the '#%' state. 
Note this differs from the +-# states described above, which increase/decrease brightness
relative to the current state.  The #% state goes directly to that level, independent of the
existing state.</P>
<P>If you have a LM14 lamp module (or any other module that supports Preset Dims),
you can use the #% preset dim states.  For example:</P>
<PRE>
  $test_light2 = new X10_Lamp('O7', 'CM11');
  $v_test_light2 = new Voice_Cmd(&quot;Set test light to [on,off,bright,dim,5%,10%,20%,30%,40%,50%,60%,70%,80%,90%]&quot;);
  set $test_light2 $state if $state = said $v_test_light2;</PRE>
<P>You can also use them directly, using &amp;P## (## = 1-&gt;64) as shown in this example:</P>
<PRE>
  $test_light1 = new X10_Item('O7');
  $v_test_light1 = new Voice_Cmd(&quot;Set test light to [on,off,bright,dim,&amp;P3,&amp;P10,&amp;P30,&amp;P40,&amp;P50,&amp;P60]&quot;);
  set $test_light1 $state if $state = said $v_test_light1;</PRE>
<P>There is another set of Preset Dim commands that are used by some modules (e.g. the RCS TX15 thermostate).
These 32 non-extended Preset Dim codes can be coded directly, using the following table:</P>
<PRE>
  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15   PRESET_DIM1
  M  N  O  P  C  D  A  B  E  F  G  H  K  L  I  J</PRE>
<PRE>
  16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  PRESET_DIM2
  M  N  O  P  C  D  A  B  E  F  G  H  K  L  I  J</PRE>
<P>For example:</P>
<PRE>
  $TX10 = new Serial_Item('XM4' . 'E' . 'PRESET_DIM1', 'Increase temp');  #preset  8='E'
  $TX10 -&gt; add           ('XM4' . 'F' . 'PRESET_DIM1', 'Decrease temp');  #preset  9='F'
  $TX10 -&gt; add           ('XM4' . 'O' . 'PRESET_DIM2', 'Preset on');      #preset 18='O'
  $TX10 -&gt; add           ('XM4' . 'P' . 'PRESET_DIM2', 'Preset off');     #preset 19='P'</PRE>
<P></P>
<DT><STRONG><A NAME="item_X10_Appliance">X10_Appliance</A></STRONG><BR>
<DD>
Same as X10_Item, except it has only has pre-defined states 'on' and 'off'
<P></P>
<DT><STRONG><A NAME="item_X10_Garage_Door%3B">X10_Garage_Door;</A></STRONG><BR>
<DD>
For the Stanely Garage Door status transmitter.  See mh/code/public/Danal/Garage_Door.pl
<P></P>
<DT><STRONG><A NAME="item_X10_IrrigationController%3B">X10_IrrigationController;</A></STRONG><BR>
<DD>
For this sprinkler device:  <A HREF="http://ourworld.compuserve.com/homepages/rciautomation/p6.htm">http://ourworld.compuserve.com/homepages/rciautomation/p6.htm</A>
<P></P>
<DT><STRONG><A NAME="item_X10_Switchlinc%3B">X10_Switchlinc;</A></STRONG><BR>
<DD>
For the Switchlinc controlers:
<PRE>
     # Just picked this device to use to send the clear
  $Office_Light_Torch-&gt;set(&quot;clear&quot;);
     # Send a command to each group member to make it listen
  $SwitchlincDisable-&gt;set(&quot;off&quot;);
     # Just picked this device item to send the command
  $Office_Light_Torch-&gt;set(&quot;disablex10transmit&quot;);</PRE>
<P></P>
<DT><STRONG><A NAME="item_X10_Ote%3B">X10_Ote;</A></STRONG><BR>
<DD>
Not sure what this is :)
<P></P>
<DT><STRONG><A NAME="item_X10_Sensor%3B">X10_Sensor;</A></STRONG><BR>
<DD>
Do you have any of those handy little X10 MS12A battery-powered motion sensors?
Here's your answer - use the X10_Sensor instead of the Serial_Item when you define
it, and your house will notice when your sensor hasn't been tripped in 24 hours,
allowing you to check on the batteries.
<P></P>
<DT><STRONG><A NAME="item_RCS_TX15">RCS_TX15</A></STRONG><BR>
<DD>
Craig is working on this one.
<P></P>
<DT><STRONG><A NAME="item_Socket_Item">Socket_Item</A></STRONG><BR>
<DD>
You can use the Socket_Item object to read and/or write to TCP/IP socket ports.
<P>Server socket ports are specified with mh.ini parms (see 'server options' in mh.ini)</P>
<PRE>
  Methods:</PRE>
<PRE>
     new('data_stream', 'state_name', 'host_port', 'name', 'host_protocol', 'datatype')
     add('data_stream', 'state_name')</PRE>
<PRE>
        'host_port' must be of the form ip_address:port or 
        it must match a server* parm in mh.ini (e.g. server1).</PRE>
<PRE>
        'host_protocol' can be 'tcp' or 'udp'.  Default is 'tcp'</PRE>
<PRE>
        'datatype'      can be 'raw' or 'record'.  If 'raw', the said
                        method returns data as read.  If record, 
                        said only returns data when reaching a newline.</PRE>
<PRE>
        'name' is optional.  If used you can set debug to this string
        to turn on debug for just this socket data.
</PRE>
<PRE>

     set_port     : Allows you to change the server_name/port.</PRE>
<PRE>
     state        : Returns the last state that was received or sent</PRE>
<PRE>
     state_now    : Returns the state that was received or sent in the current pass.</PRE>
<PRE>
     set          : Sets the item to the specified state.
                     - If the specified state has not been defined with 'new' or 'add', 
                       the state data is sent.  Otherwise the data_stream associated
                       with that state is sent.</PRE>
<PRE>
     set_echo     : Use this to control echoing of incoming characters:
                     set_echo $my_socket 0   -&gt; Do not echo incoming characters
                     set_echo $my_socket 1   -&gt; echo incoming characters
                     set_echo $my_socket '*' -&gt; echo incoming characters with *</PRE>
<PRE>
     set_expect   : Used to send a series of strings to the port, waiting for
                    a specified prompt for each string.  This is useful for
                    walking through menus.  The arguments passed to set_expect
                    are pairs of 'prompt' =&gt; 'response' strings.  See example below.</PRE>
<PRE>
     said         : Returns a data record received by the port.  
                     - Note: If you want to process binary socket data, specify 
                             server_*_datatype = raw in the mh.ini file.  This
                             will cause said to return any data read immediately, 
                             rather than buffering up data until a newline is read.</PRE>
<PRE>
     said_next    : Reads and returns the next record from the socket handle</PRE>
<PRE>
     handle       : Returns the socket handle, so you can loop on reading/writing data
                    to it directly.</PRE>
<PRE>
     start        : Connect to the specified port.  This allows mh to act as a client,
                    rather than a server, and initiate communications with a server.</PRE>
<PRE>
     stop         : This will drop the client or server from mh and free up the port.</PRE>
<PRE>
     active       : True if the port is active
     active_now   : True for the mh pass that the socket first becomes active.
     inactive_now : True for the mh pass that the socket first becomes inactive.</PRE>
<PRE>
  Examples:</PRE>
<PRE>
    $socket_server = new  Socket_Item(undef, undef, 'server_speak');
    if (my $data = said $socket_server) {
       print &quot;speak_server socket data: $data\n&quot;;
       speak $data;
    }</PRE>
<PRE>
    my $lcdproc_address = 'misterhouse:13666';
    $lcdproc = new  Socket_Item(undef, undef, $lcdproc_address, 'lcdproc');</PRE>
<PRE>
    $Vcmd_viavoice = new  main::Socket_Item(undef, undef, 'localhost:3234', 'viavoice');</PRE>
<PRE>
                                 # This example walks the reboot menu of a router
    $router_reboot = new Voice_Cmd 'Reboot the router';
    $router_client = new Socket_Item(undef, undef, $config_parms{router_address} . &quot;:23&quot;,
                                     'router', 'tcp', 'raw');
    set_expect $router_client (Password =&gt; $config_parms{router_password}, Number =&gt; 24,
                               Number =&gt; 4, Number =&gt; 11) if said $router_reboot;</PRE>
<P>More examples are in mh/code/bruce/telnet.pl, mh/code/public/Brian/tracker.pl,
my/code/bruce/mh_watchdog.pl, and mh/code/test/socket_test.pl</P>
<P></P>
<DT><STRONG><A NAME="item_Timer">Timer</A></STRONG><BR>
<DD>
The Timer object can be used to run an action one or more times, at a specified interval.
<PRE>
  Methods:</PRE>
<PRE>
    new        : Used to create the object.</PRE>
<PRE>
    set($period, $action, $cycles)
        $period is the timer period in seconds
        $action (optional) is the code (either a string or a code
                 reference) to run when the timer expires
        $cycles (optional) is how many times to repeat the timer</PRE>
<PRE>
    unset      : Unset the timer.  'set $my_timer 0' has the same effect.</PRE>
<PRE>
    active     : Returns true if the timer is still running.
    inactive   : Returns true if the timer is has expired or has not been set.
    expired    : Returns true for the one pass after the timer has expired.</PRE>
<PRE>
    run_action : Runs the timers action, even if the timer has not expired.</PRE>
<PRE>
    hours_remaining,   hours_remaining_now
    minutes_remaining, minutes_remaining_now
    seconds_remaining, seconds_remaining_now</PRE>
<PRE>
        These methods return the hours, minutes or seconds remaining on the timer.
        The _now methods only return the remaining time on the hour, minute,
        or second boundary.</PRE>
<PRE>
  Examples:</PRE>
<PRE>
    $timer_laundary = new  Timer;
    $v_laundary_timer = new  Voice_Cmd('Laundary timer [on,off]');
    if ($state =  said $v_laundary_timer) {
       if ($state eq ON) {
          play('rooms' =&gt; 'shop', 'file' =&gt; 'cloths_started.wav');
          set $timer_laundary 35*60, 'speak &quot;rooms=all The laundary clothes done&quot;', 4;
       }
       else {
          speak 'rooms=shop The laundry timer has been turned off.';
          unset $timer_laundary;
       }
    }</PRE>
<PRE>
                   # This example uses an anonymous subroutine
    $v_test_delay = new  Voice_Cmd 'Test timer with [1,5,10] seconds';
    if ($state = said $v_test_delay) {
       print_log &quot;Starting $state second timer test&quot;;
       my  $timer = new Timer;
       set $timer $state, sub {
          print_log &quot;Ending $state second timer test&quot;;
       }
#      set $timer $state, &quot;print_log 'Ending $state second timer test'&quot;;
    }</PRE>
<PRE>
    See mh/code/bruce/timers.pl for more examples</PRE>
<P></P>
<DT><STRONG><A NAME="item_Voice_Cmd">Voice_Cmd</A></STRONG><BR>
<DD>
Use the Voice_Cmd object to create voice commands.  Even without a Voice Recognition engine installed,
this is useful as these commands can also be run from the Tk, web, telnet, and file interfaces.
<PRE>
  Methods:
     new($command, $response, $confirm, $vocabulary)</PRE>
<PRE>
        $command can be a simple string (e.g. 'What time is it') or it can 
        include a list of 'states' (e.g. 'Turn the light [on,off]').  The state
        enumeration group is a comma delimited string surrounded with [].</PRE>
<PRE>
        In addition to one state enumeration group, you can specify any number
        of phrase enumeration groups.  These are comma delimited strings
        surounded by {} (e.g. 'Turn the {family room,downstairs} TV [on,off]').
        Use this when you have several different ways to describe the same thing.</PRE>
<PRE>
        $response is the text or wave file that will be played back when the
        VR engine detects this command.  If not defined, the response 
        is : &quot;I heard $command&quot; (on viavoice).</PRE>
<PRE>
        You can put %STATE% or any variable in the response string and have it
        substituted/evaluated when the response is spoken</PRE>
<PRE>
        $confirm is either 0 or 1 (default is 0).  If set to 1, then mh will
        ask 'Confirm with a yes or a no'.  If yes or no is not heard within
        10 seconds, the command is aborted.</PRE>
<PRE>
        $vocabulary allows you to define multiple vocabularies.  You 
        can then use these functions to enable and disable the vocabularies:</PRE>
<PRE>
             &amp;Voice_Cmd::enablevocab($vocabulary)
             &amp;Voice_Cmd::disablevocab($vocabulary)</PRE>
<PRE>
        Vocabularies are enabled by default.  The default vocabulary
        is 'misterhouse'.  See mh/code/bruce/viavoice_control.pl for examples.
        This code allows you to switch between 'awake', 'asleep', and 'off' VR modes.</PRE>
<PRE>
        NOTE:  
           Currently only the viavoice VR engine (mh.ini parm voice_cmd=viavoice)
           will use the $response, $confirm, and $vocabulary_name options.
           We may be able to create a viavoice_server for windows, but that would
           probably not be free like it is on linux.  If you have a linux box
           on your network, you can have your windows mh use the linux
           viavoice_server process.</PRE>
<PRE>
     said  : Is true for the one pass after the command was issued.
             If the command was built from a list of possible states, 
             then said returns the state that matches.</PRE>
<PRE>
     state : Returns the same thing as said, except it is valid for all passes,
             not just the pass after the command was issued.
</PRE>
<PRE>

     set_icon : Point to the icon member you want the web interface to use.
                See the 'Customizing the web interface' section of this document for details.</PRE>
<PRE>
  Examples:        
    $v_backyard_light = new  Voice_Cmd 'Backyard Light [on,off]';
    set $backyard_light $state if $state = said $v_backyard_light;</PRE>
<PRE>
    $v_test1 = new Voice_Cmd '{turn,set} the {living,famliy} room {light,lights} [on,off]';
    $v_test2 = new Voice_Cmd '{Please, } tell me the time';
    $v_test3 = new Voice_Cmd '{What time is it,Tell me the time}';
    $v_fan   = new Voice_Cmd 'Fan [on,off]', 'Ok, I turned the fan $v_indoor_fountain-&gt;{said}';
    $v_fan   = new Voice_Cmd 'Fan [on,off]', 'Ok, I turned the fan %STATE%';</PRE>
<P>See mh/code/examples/Voice_Cmd_enumeration.pl for more Voice_Cmd examples</P>
<P>In addition to the said command on a specific object, you can use
&amp;Voice_Cmd::said_this_pass  to detect which command was spoken this pass and 
&amp;Voice_Cmd::noise_this_pass to detect if noise was detected this pass 
(this function currently only works with viavoice).</P>
<PRE>
  Examples:</PRE>
<PRE>
   if (my $speak_num = &amp;Voice_Cmd::said_this_pass) {
      my $text = &amp;Voice_Cmd::text_by_num($speak_num);
      print_log &quot;spoken text: $speak_num, $text&quot;;
   }</PRE>
<PRE>
   if (my $text = &amp;Voice_Cmd::noise_this_pass) {
      print_log &quot;Noise detected&quot; if $text eq 'Noise';
   }</PRE>
<P>See mh/code/bruce/lcdproc.pl for more examples.</P>
<P></P>
<DT><STRONG><A NAME="item_DSC_Alarm">DSC_Alarm</A></STRONG><BR>
<DD>
DSC_Alarm module supports the DSC PC5400 serial printer interface. This allows mh 
to be aware of events that DSC alarm systems log to their event buffers.
<PRE>
  Required mh.ini entries:
    DSC_Alarm_serial_port=COM1 or /dev/ttys0
    DSC_Alarm_baudrate=4800</PRE>
<PRE>
  Multiple instances may be supported by adding instance
  numbers to the parms as in:
    DSC_Alarm:1_serial_port=COMx or /dev/ttysX
    DSC_Alarm:1_baudrate=4800
    DSC_Alarm:2_serial_port=COMy or /dev/ttysY
    DSC_Alarm:2_baudrate=4800</PRE>
<PRE>
  Optional mh.ini entries:
    DSC_Alarm_user_40=Jane Doe
    DSC_Alarm_user_1=Bob Smith
</PRE>
<PRE>

    See the &quot;user&quot; method below for a description.</PRE>
<PRE>
  Methods:
     new('alarm-name')</PRE>
<PRE>
        Where 'alarm-name' is the prefix used in the mh.ini entry 'DSC_Alarm_serial_port=xyz'. 
        The 'alarm-name' argument defaults to 'DSC_Alarm' if not specified.</PRE>
<PRE>
     said         : Returns the last serial data received.  Valid for 1 pass only.</PRE>
<PRE>
     Important Note:  Due to mh internals, the &quot;said&quot; method and the &quot;state&quot; method (and
     all &quot;state&quot; derived methods) lag each other's values by 1 pass through the user scripts.
     As such, any given script should use &quot;said&quot; or &quot;state&quot;, but should NOT mix the two!</PRE>
<PRE>
     state        : Returns last state of alarm system from following values:
                    Armed    = System is closed and armed.
                    Disarmed = System is opened.
                    Alarm    = System is alarming.</PRE>
<PRE>
     state_now    : Same as state, but valid for 1 pass only.</PRE>
<PRE>
     user         : User number of last code used to arm/disarm system.</PRE>
<PRE>
                    If present, mh.ini parm DSC_Alarm_user_nn=xyz will cause &quot;user&quot; 
                    to return string &quot;xyz&quot; from the parm.</PRE>
<PRE>
     alarm_now    : True when system enters Alarm state.  Valid for 1 pass only.</PRE>
<PRE>
     zone         : Zone number that caused Alarm. Valid only when alarm_now is true.
</PRE>
<PRE>

     mode         : Returns arming mode. Valid only when state = Armed.
                    Stay = System armed in stay mode; User pressed F1 key before arming.
                    Away = System armed in away mode; User pressed F2 key (or nothing) before arming</PRE>
<PRE>
                    Note: Most DSC systems will not arm in &quot;Stay&quot; mode unless at least one zone
                          is defined as a &quot;Stay/Away&quot; zone.  Also, even when &quot;Away&quot; mode is requested
                          system will be in &quot;Stay&quot; mode unless a delay zone is violated during the
                          exit delay.</PRE>
<PRE>
     Most other Generic_Item methods, such as &quot;state_log&quot;, are valid.</PRE>
<PRE>
  Logging:
     The internal support module for DSC_Alarm (DSC_Alarm.pm) maintains a log of 
     all serial data received from the DSC PC5400 interface.  This log is placed 
     in /mh.ini parm data_dir/logs/$port_name.YYYY_MM.log; for example, the log 
     entries shown below would be in file '/mh/data/logs/DSC_Alarm.2000_10.log'.
     This implies a new log will be started each month.</PRE>
<PRE>
  DSC User Codes:
     40 = Master code (can arm/disarm, change codes, any keypad function)
     41 = Supervisor code (can arm/disarm, change codes)
     42 = Supervisor code (can arm/disarm, change codes)
     01-32 = User codes (can arm/disarm, can be associated to individual wireless keys)
     33 = Duress code (can arm/disarm + sends duress code to master station)
     34 = Duress code (can arm/disarm + sends duress code to master station)
</PRE>
<PRE>

     The above information derived from PC1555 master panel; please see the installer
     manual for your particular panel for further information.</PRE>
<PRE>
     Duress code reporting is NOT reflected via states as of December 2000.  
     Coming soon...</PRE>
<PRE>
  Examples:
    mh.ini entry of 'DSC_Alarm_serial_port=com2' 
</PRE>
<PRE>

    $DSC_Alarm = new DSC_Alarm;
    if (my $log = said $DSC_Alarm) {
       print_log &quot;Alarm system data = $log\n&quot;;
    }</PRE>
<PRE>
    mh.ini entry of 'DSC_Alarm:2_serial_port=com5' 
</PRE>
<PRE>

    $DSC_test = new DSC_Alarm('DSC_Alarm:2');
    if (my $state = state $DSC_test) {
       print_log &quot;Alarm system state change, state = $state\n&quot;;
    }</PRE>
<PRE>
  Examples of typical DSC alarm system event/log entries:</PRE>
<P>Mon 10/09/00 17:09:00 DSC_Alarm.pm Initialized
Mon 10/09/00 17:10:16  17:10 10/09/00 System         [*1] Access by User
Mon 10/09/00 17:12:28  17:12 10/09/00 System         Partial Closing 
Mon 10/09/00 17:12:28  17:12 10/09/00 System         Bypass Zone     1    
Mon 10/09/00 17:12:28  17:12 10/09/00 System         Bypass Zone     2    
Mon 10/09/00 17:12:28  17:12 10/09/00 System         Bypass Zone     4    
Mon 10/09/00 17:12:29  17:12 10/09/00 System         Closing by User Code 40
Mon 10/09/00 17:12:29  17:12 10/09/00 System         Armed in Away Mode
Mon 10/09/00 17:12:45  17:12 10/09/00 System         Opening by User Code 2
Mon 10/09/00 17:14:42  17:14 10/09/00 System         Closing by User Code 40
Mon 10/09/00 17:14:43  17:14 10/09/00 System         Armed in Away Mode
Mon 10/09/00 17:14:47  17:14 10/09/00 System         Opening by User Code 40
Mon 10/09/00 17:22:28  17:22 10/09/00 System         [*1] Access by User
Mon 10/09/00 17:33:39 DSC_Alarm.pm Initialized
Tue 10/10/00 09:47:38  09:47 10/10/00 System         Closing by User Code 40
Tue 10/10/00 09:47:38  09:47 10/10/00 System         Armed in Away Mode
Tue 10/10/00 17:48:42  17:48 10/10/00 System         Opening by User Code 40
Tue 10/10/00 23:37:33  23:37 10/10/00 System         Closing by User Code 40
Tue 10/10/00 23:37:33  23:37 10/10/00 System         Armed in Away Mode
Wed 10/11/00 07:38:11  07:38 10/11/00 System         Opening by User Code 40</P>
<P></P></DL>
<P>
<H2><A NAME="list of functions">List of functions</A></H2>
<DL>
<DT><STRONG><A NAME="item_add_sound">add_sound</A></STRONG><BR>
<DD>
Assigns a sound file to an event name.  This allows us to create and review event sounds.
See mh/code/test/event_sounds.pl for an example.
<PRE>
  Example:</PRE>
<PRE>
    add_sound barcode_scan =&gt; 'sound_nature/bird.wav', volume =&gt; 20 if $Reload;
    if ($state = state_now $barcode_scan) {
        play 'barcode_scan';
    }</PRE>
<P></P>
<DT><STRONG><A NAME="item_browser">browser</A></STRONG><BR>
<DD>
Calls up the web browser defined my the mh.ini browser parm
<PRE>
  Examples:</PRE>
<PRE>
    browser '<A HREF="http://misterhouse.net:81">http://misterhouse.net:81</A>';
    browser &quot;$config_parms{tracking_dir}/today.html&quot; if said $v_show_tracking;</PRE>
<P></P>
<DT><STRONG><A NAME="item_convert_k2f">convert_k2f</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_convert_c2f">convert_c2f</A></STRONG><BR>
<DD>
Converts from degrees Kelvin/Centigrade to Farenheight
<PRE>
  Example:</PRE>
<PRE>
    $weather{TempF} = convert_c2f($weather{TempC});</PRE>
<P></P>
<DT><STRONG><A NAME="item_convert_direction">convert_direction</A></STRONG><BR>
<DD>
Converts 0-&gt;360 degrees into north, north east, east, etc
<PRE>
  Example:</PRE>
<PRE>
    speak &quot;Wind speed is &quot; . round($weather{WindAvgSpeed}) .
          &quot; from the &quot; . convert_wind_direction($weather{WindAvgDir});</PRE>
<P></P>
<DT><STRONG><A NAME="item_dbm_write">dbm_write</A></STRONG><BR>
<DD>
Writes data into a dbm file.  If data for that key exists, it is overwritten.  dbm files
are useful if you want to store key-value data or hash arrays onto disk for later use.
<PRE>
  Usage:</PRE>
<PRE>
    logit_dbm($log_file, $log_key, $log_data);</PRE>
<PRE>
  Examples:</PRE>
<PRE>
    logit_dbm(&quot;$Pgm_Root/data/phone/callerid.dbm&quot;,
              $cid_number, &quot;$Time_Now $Date_Now $Year name=$cid_name&quot;);</PRE>
<PRE>
    See display_callers for an example of how to read dbm files.</PRE>
<P></P>
<DT><STRONG><A NAME="item_dbm_read">dbm_read</A></STRONG><BR>
<DD>
Read data from a dbm file.  If a key is passed, only that one record is returned.  Otherwise,
the whole dbm is read.
<PRE>
  Usage:</PRE>
<PRE>
    $value = read_dbm($dbm_file, $key);
    %data  = read_dbm($dbm_file);</PRE>
<P></P>
<DT><STRONG><A NAME="item_dbm_search">dbm_search</A></STRONG><BR>
<DD>
Search a dbm file for matches to a string.  It currently searches both key and value.
<PRE>
  Usage:</PRE>
<PRE>
    ($count_searched, $count_matched, %results) = search_dbm($dbm_file, $search_string);</PRE>
<PRE>
  See mh/code/bruce/phone.pl and mh/bin/display_callers for examples.</PRE>
<P></P>
<DT><STRONG><A NAME="item_display">display</A></STRONG><BR>
<DD>
Displays the specified text string, text file contents, or bitmap (.gif or .jpg).
<PRE>
  Simple mode:
     display $file_or_text, $time, $title, $font, $window_name, $append;</PRE>
<PRE>
  Options mode:
     display option =&gt; 'value', text =&gt; $file_or_text;</PRE>
<PRE>
  Options:
      $time is how long (in seconds) till the box will auto-close.
             Defaults to 120.  Use 0 to disable auto-close.
      $title is the title of the display box.
      $font  is the font (default is mh.ini parm tk_font).
      $window_name will re-use an exisiting display window of the same name.
      $append can be top or bottom.  Only meaningful with $window_name.
</PRE>
<PRE>

  Examples:</PRE>
<PRE>
    display &quot;Internet message: $msg&quot;, 300, 'Internet message'; 
    display $f_trivia_answer;
    display '/pictures/photo.jpg';
    display text =&gt; $log, time =&gt; 0, font =&gt; 'fixed', window_name =&gt; 'log';
    display text =&gt; $text, time =&gt; 0, window_name =&gt; 'AIM', append =&gt; 'top';</PRE>
<P>If -tk 1 (i.e. Tk is installed and used), the data is displayed in a Tk popup window.
If -tk 0 or the data is echoed to the console.</P>
<P>If the data is requested from a web browser, the data is echoed to the browser print_log 
window.  It will be displayed to a local tk window only if the $time parm is specified.</P>
<P></P>
<DT><STRONG><A NAME="item_file_changed">file_changed (or older name of file_change)</A></STRONG><BR>
<DD>
Returns 1 if the specified file has change since last checked.
Returns 0 if the file has not changed.
Returns undef if we don't know (i.e. first check after mh was started).
<PRE>
  Example:</PRE>
<PRE>
    print_log &quot;File $file has change&quot; if file_changed($file);</PRE>
<P></P>
<DT><STRONG><A NAME="item_file_unchanged">file_unchanged</A></STRONG><BR>
<DD>
Returns 0 if the specified file has change since last checked.
Returns 1 if the file has not changed.
Returns undef if we don't know (i.e. first check after mh was started).
<PRE>
  Example:</PRE>
<PRE>
    my $watchdog_file = '//dm/d/misterhouse/mh/data/mh.time';
    if (file_unchanged $watchdog_file) {
        speak &quot;MisterHouse has stopped running on the Nick's box&quot;;
        set_with_timer $watchdog_light '20%', 5;
    }</PRE>
<P></P>
<DT><STRONG><A NAME="item_file_diff">file_diff</A></STRONG><BR>
<DD>
Returns true if the contents of the 2 specified files are different.
<PRE>
  Example:</PRE>
<PRE>
    print_log &quot;Files are different&quot; if file_diff($file1, $file2);</PRE>
<P></P>
<DT><STRONG><A NAME="item_file_read">file_read</A></STRONG><BR>
<DD>
Reads data from a file.
If used in a list context, a list is returned, otherwise a string of all the lines.
<PRE>
  Examples:</PRE>
<PRE>
     @data = file_read($file);
     $data = file_read($file);</PRE>
<P></P>
<DT><STRONG><A NAME="item_file_write">file_write</A></STRONG><BR>
<DD>
Writes data into a file.  Like logit, except it writes over, rather than appends to, a file.
<PRE>
  Examples:</PRE>
<PRE>
     file_write($file, $data);</PRE>
<P></P>
<DT><STRONG><A NAME="item_file_cat">file_cat</A></STRONG><BR>
<DD>
Concatonates data from one file onto another.  If an optional 3rd parm of 'top' is specified, 
the first files is added to the top of the 2nd file.  If not, then it is added to the bottom.
<PRE>
  Examples:</PRE>
<PRE>
    file_cat $file, $file_total;</PRE>
<PRE>
    file_cat &quot;$config_parms{html_dir}/aprs/week2.html&quot;,
             &quot;$config_parms{html_dir}/aprs/old/${Year_Month_Now}.html&quot;,
             'top';</PRE>
<P></P>
<DT><STRONG><A NAME="item_file_head_file_tail">file_head file_tail</A></STRONG><BR>
<DD>
Returns the first/last few lines of a file
<PRE>
  Examples:</PRE>
<PRE>
     @data = file_head($file, $lines);
     $data = file_tail($file, $lines);</PRE>
<PRE>
   If $lines is not specified, the default is 3.
   If used in a list context, a list is returned,
   otherwise a string of all the requested lines is returned.</PRE>
<P></P>
<DT><STRONG><A NAME="item_filter_cr">filter_cr</A></STRONG><BR>
<DD>
Returns the given string, with carriage returns and line feeds filtered out
<PRE>
  Examples:</PRE>
<PRE>
    print_log filter_cr get &quot;$url/play?p=$config_parms{mp3_program_password}&quot;;</PRE>
<P></P>
<DT><STRONG><A NAME="item_logit">logit</A></STRONG><BR>
<DD>
Appends data into a log file.  Use file_write to write over a file.
<PRE>
  Usage:</PRE>
<PRE>
    logit($log_file, $log_data, $log_format, $head_tail);</PRE>
<PRE>
      $log_format=0  =&gt;  Data is written as is, no /n, no time_date stamp.</PRE>
<PRE>
      $log_format=## =&gt;  Every log entry is preceded with a time_date stamp.
                         ## is passed to &amp;time_date_stamp to determine the format.
                         Also, /r/n is stripped so we get only one record per call.</PRE>
<PRE>
                         The default  $log_format is 14.</PRE>
<PRE>
      $head_tail     =&gt;  If 1, data is logged to the top of the file, otherwise
                         it is added to the bottom.</PRE>
<PRE>
  Examples:</PRE>
<PRE>
   logit(&quot;$Pgm_Root/data/logs/wx200.$Year_Month_Now.log&quot;,  $data, 0);
   logit(&quot;$Pgm_Root/data/phone/logs/callerid.$Year_Month_Now.log&quot;, &quot;$cid_number $cid_name&quot;);</PRE>
<P></P>
<DT><STRONG><A NAME="item_play">play</A></STRONG><BR>
<DD>
Use this to play wave or system sound files.  There are 2 modes of calling it:
<PRE>
   Simple mode:
     play  $file_name</PRE>
<PRE>
   Options mode:
     play(option =&gt; 'value', file =&gt; $file_name);</PRE>
<PRE>
     Options are:
       rooms =&gt; 'room_names'  You need to code a &amp;Play_pre_add_hook to enable this.
                              See mh/code/bruce/pa_control for an example.
       volume=&gt; dd            How loud (dd = 0-&gt;100).  
       time  =&gt; $time         The amount of time to leave the PA speakers on for rooms
       mode  =&gt; $mode         $mode can be:
         wait  : mh will pause (hang), until wav file finishes
         loop  : mh will loop on the wav file
         stop  : mh will stop playing the previous file
         async : mh will play wave file asynchronously (in the background).  This is the default.</PRE>
<PRE>
       mode   =&gt; 'unmuted'     Forces speech, even in mute and offline mode</PRE>
<PRE>
       You can control the default mode parm with the mh.ini play_mode parm.</PRE>
<P>If $file_name is a blank or comma delimited list of 
files, they are played sequentially.  If it is a wild-carded file specification
(e.g. ``movement*.wav''), then a file is picked at random from the files that match.</P>
<P>If the file does not include a path specification, the file is looked for in the mh/sounds directory.</P>
<P>If the file starts with System or with sound_, the sound file is NOT logged in the speak log.</P>
<P>Here are the names of some of the Windows System sounds.  Use the Control Panel 
Sounds menu to change their associated wav files:</P>
<PRE>
   - MenuPopup
   - SystemDefault
   - SystemAsterisk
   - SystemExclamation
   - SystemExit
   - SystemHand
   - SystemQuestion
   - SystemStart</PRE>
<PRE>
   Examples:</PRE>
<PRE>
                        # Play a random 'garage open/close' wav file
     if($state = state_now $garage_door) {   # $state will be open or close
       play(rooms =&gt; 'all', file =&gt; &quot;garage_door_&quot; . $state . &quot;*.wav&quot;);
     }</PRE>
<PRE>
     play(file =&gt; 'SystemAsterisk') if $Reload;</PRE>
<PRE>
     play &quot;fun/*.wav&quot; if time_cron '* 9 * * 6';</PRE>
<P></P>
<DT><STRONG><A NAME="item_print_log">print_log</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_print_msg">print_msg</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_print_speaklog">print_speaklog</A></STRONG><BR>
<DD>
Use these to print to the various logs. These logs are listed in Tk and web frames.
<P>print_log is typically used for fairly frequent, not too important messages.
If you want the message logged to a specific file (in the directory pointed to by mh.ini parm data_dir),
you can prefix the text with log=my_logfile.  For example:</P>
<PRE>
  print_log 'log=test1.log This message is logged in test1.log';</PRE>
<P>print_msg is typically used for less frequent, more important messages.
This is not currently shown on the default web windows.</P>
<P>print_speaklog is called by the speak and play functions, so should not be normally used in user code.</P>
<P></P>
<DT><STRONG><A NAME="item_round">round</A></STRONG><BR>
<DD>
Use this function to round off a number.  Usage:
<PRE>
   round $number, $digits</PRE>
<P>If $digits &lt; 10,  $number is rounded to $digits to the right of the decimal</P>
<P>If $digits &gt;= 10, $number is rounded to $digits nearest $digits</P>
<P>Examples:</P>
<PRE>
   $time_left = round $time_left, 1; Round to nearest tenth</PRE>
<PRE>
   $rank = round $1, 100; # Round to nearest 100</PRE>
<P></P>
<DT><STRONG><A NAME="item_run">run</A></STRONG><BR>
<DD>
You can use the run function to run a program as a separate process.  On Windows, the perl Win32::Process function is used,
and on Unix, the program is forked with &amp;.
<P>If you specify 'inline' as the first argument, the program will not be a background process/forked.
mh will pause until the program is done.</P>
<PRE>
  Examples:
     run('IR_cmd VCR,3,6,RECORD');  # Start a VCR recording
     run 'rasdial /disconnect';     # Log off from the net (on Windows)
     run 'inline', 'some_fast_command_here';
     run 'mplayer.exe /play /close c:\win98\media\canyon.mid'; # Play a midi file</PRE>
<P></P>
<DT><STRONG><A NAME="item_run_after_delay">run_after_delay</A></STRONG><BR>
<DD>
You can use this to create events with built in delays without causing mh to pause
<PRE>
   Example:</PRE>
<PRE>
                   # After 2 seconds, this evals the print_log string
     run_after_delay 2, &quot;print_log 'Ending delay test 1'&quot;;</PRE>
<PRE>
                   # This runs anonymous subs to print after 2 and 3 seconds.
     run_after_delay 2, sub {
       print_log &quot;Printed after 2 seconds&quot;;
       run_after_delay 1, sub {
         print_log &quot;Printed after 1 more second seconds&quot;;
       }
     }</PRE>
<P></P>
<DT><STRONG><A NAME="item_run_voice_cmd">run_voice_cmd</A></STRONG><BR>
<DD>
You can use this to have one event trigger another voice command event.
<PRE>
   Example:</PRE>
<PRE>
      run_voice_cmd 'Get the top10 list' if time_now('6:30 AM');</PRE>
<P></P>
<DT><STRONG><A NAME="item_SendKeys_WaitForAnyWindow_SetWindowText_GetWindowT">SendKeys WaitForAnyWindow SetWindowText GetWindowText SetFocus EnumChildWindows sendkeys_find_window</A></STRONG><BR>
<DD>
On Windows systems, use these functions to control other programs.
Full documentation is mh/lib/site/Win32/setupsup.html.
<PRE>
   SendKeys($window, $keystr, $activate, [$timeout])
   WaitForAnyWindow($title, \$window, $timeout, [$refresh])
   SetFocus($window)
   EnumChildWindows($window, \@childs)</PRE>
<P>WaitForAnyWindow will set the window handle for the window that matches the (sub)string specified in $title.</P>
<P>WaitForWindow is like WaitForWindow, but requires an exact string match for the window title.</P>
<P>SetWindowText is useful in changing a genericlly named window to a specific name that can then
be accessed via WaitForAnyWindow.  Also, since WaitForAnyWindow will match
the first (left most) part of any title, GetWindowText allows one to get window
specific info that can be used to determine the status of the window application.</P>
<P>SendKeys sends the keys.  Here is an excerpt of the valid key list:</P>
<PRE>
   ALT+ alt down ALT- alt up CTRL+ ctrl down CTRL- ctrl up SHIFT+ shift down SHIFT- shift up
   TAB tabulator RET return ESC escape BACK backspace DEL delete INS insert HELP help
   LEFT arrow left RIGHT arrow right UP arrow up DN arrow down PGUP page up PGDN page down
   BEG pos1 END end F1 function 1 ... F12 function 12
   NUM0 0 on the num block ... NUM9 9 on the num block 
   NUM* multiply key on the num block 
   NUM+ add key on the num block NUM- minus key on the num block NUM/ divide key on the num block</PRE>
<P>SetFocus sets the focus to $window. It does not activate the window (the foreground
application will not be changed if $windows belongs to another
application).</P>
<P>EnumChildWindows enumerates all child windows that belong to $window and
returns the handles in the @childsCODE&gt; array. $window
must be a valid window handle @childs must be an array reference.</P>
<P>sendkeys_find_window is an mh subroutine that calls WaitForAnyWindow.
If the window is not found and $program is specified, it will start $program and
wait for the window to appear, then return the window handle.</P>
<PRE>
   sendkey_find_window($title, [$program]);</PRE>
<P>Here are a few examples:</P>
<PRE>
                    # Start winamp, if it is not running
   unless (&amp;WaitForAnyWindow('Winamp', \$window, 100,100)) {
       print_log &quot;Starting winamp&quot;;
       run $config_parms{mp3_program};
   }</PRE>
<PRE>
                    # Send/receive mail, using sendkeys_find_window to start the program 
                    # if it is not already running
   if (my $window = &amp;sendkeys_find_window('Outlook', 'D:\msOffice\Office\OUTLOOK.EXE')) {
      my $keys = '\\alt+\\tss\\alt-\\';  # For Outlook Express
      my $keys = '\\alt\\te\\ret\\';     # For Outlook
      &amp;SendKeys($window, $keys, 1, 500);
   }</PRE>
<P></P>
<DT><STRONG><A NAME="item_speak">speak</A></STRONG><BR>
<DD>
Passes specified text to the TTS program.  There are 2 modes of calling it:
<PRE>
   Simple mode:
     speak 'text to speak';
     speak 'option=value text to speak';</PRE>
<PRE>
   Options mode:
     speak(option =&gt; 'value', text =&gt; 'text to speak');
</PRE>
<PRE>

     Options are:
       rooms  =&gt; 'room_names'  You need to code a &amp;Speak_pre_add_hook to enable
                               this.  See mh/code/bruce/pa_control for an example.</PRE>
<PRE>
       mode   =&gt; 'unmuted' Forces speech, even in mute and offline mode</PRE>
<PRE>
     These options are for the Festival speech engine (but don't work yet):
       rate   =&gt; '+-nn%'       (e.g. +10% or -30%)
       voice  =&gt; 'name'</PRE>
<PRE>
     These options are currently for the MS TTS engine only.
       mode   =&gt; any of the following
        stop, pause, resume, rewind, fastforward, slow, normal, fast, dd</PRE>
<PRE>
       voice  =&gt; 'name'
                 Example voices: Mike,Mary,Sam,random,male,female</PRE>
<PRE>
       volume =&gt; dd (dd = 0 -&gt; 100).</PRE>
<PRE>
       rate   =&gt; fast,normal,slow,dd
                 For the V4 engine, dd is words per minute.
                 For the V5 engine, dd is -10 -&gt; 10 for slowest to fastest</PRE>
<PRE>
       pitch  =&gt; dd (dd = -10 -&gt; 10)</PRE>
<PRE>
       to_file =&gt; xyz.  Saves speech to file xyz, then plays the file.</PRE>
<PRE>
   With the MS TTS V4 engine, the rate parm effects all subsequent
   spoken text (volume and voice parms do nothing).</PRE>
<PRE>
   With the MS TTS V5 engine, the volume, rate, and voice parms will effect
   only the specified text.   If you want to change the default for all text,
   specify the parm, but no text (e.g. speak voice =&gt; 'Sam')</PRE>
<PRE>
   The MS TTS V5 engine also supports embedded XML parms for other controls (e.g. pitch,
   silence, pronounce, emphasis).   See mh/doc/ms_speech_xml_example.* for examples.</PRE>
<PRE>
   Examples:</PRE>
<PRE>
    $test_voice1 = new Voice_Cmd &quot;Say something with at a volume of [50,100]&quot;;
    $test_voice2 = new Voice_Cmd &quot;Say something at a [fast,slow,normal] speed&quot;;
    $test_voice3 = new Voice_Cmd &quot;Say something in voice [male,female]&quot;;</PRE>
<PRE>
    speak(volume =&gt; $state, 
          text =&gt; &quot;This is an example at a volume of $state&quot;)    if $state = said $test_voice1;
    speak(rate   =&gt; $state,
          text =&gt; &quot;This is an example at a rate of $state&quot;)    if $state = said $test_voice2;
    speak(voice  =&gt; $state,
          text =&gt; &quot;This is an example of a $state voice&quot;) if $state = said $test_voice3;
</PRE>
<PRE>

    $Save{mode} = 'mute' if time_cron '0 10-21 * * 1-5';
    speak 'mode=unmuted  The front door just opened';
    speak mode =&gt; 'pause';
    speak mode =&gt; 'resume', rate =&gt; 120;</PRE>
<PRE>

    speak &quot;Now I am really, &lt;pitch absmiddle='10'/&gt;really excited!&quot;</PRE>
<PRE>
    speak to_file =&gt; &quot;$config_parms{data_dir}/test_tts.wav&quot;,
          text =&gt; read_next $house_tagline if $New_Minute;</PRE>
<P></P>
<DT><STRONG><A NAME="item_time_add">time_add</A></STRONG><BR>
<DD>
Use this to add/delete an offset to a time value, using the same syntax as offsets allowed for in time_now.
<PRE>
   Examples:</PRE>
<PRE>
    my $fishtank_light_on_time,$fishtank_light_off_time,$fishtank_light_duration;
    if ($Startup) {
      $fishtank_light_on_time  = time_add &quot;$Time_Sunrise_Twilight+3:00&quot;;
      $fishtank_light_off_time = time_add &quot;$Time_Sunset_Twilight+4:00&quot;;
      $fishtank_light_duration = time_add &quot;$fishtank_light_off_time-$fishtank_light_on_time&quot;;
    }</PRE>
<P></P>
<DT><STRONG><A NAME="item_time_diff">time_diff</A></STRONG><BR>
<DD>
This function returns the time difference between 2 time values.   The roundoff
time unit is dependent on how big the difference is between the 2 times.
For example, if the time difference is &gt; 5 days, the returned value will be in days.
<PRE>
   Examples:</PRE>
<PRE>
   my $diff = time_diff $Moon{time_full}, $Time;
   speak &quot;The last full moon was $diff ago&quot;;</PRE>
<P></P>
<DT><STRONG><A NAME="item_time_date_stamp">time_date_stamp</A></STRONG><BR>
<DD>
You can use this function to return a time/date string.
<PRE>
  Usage:</PRE>
<PRE>
    time_date_stamp($format, $file_or_time);</PRE>
<PRE>
    $format can be any of the following:</PRE>
<PRE>
      1:   Monday, 08/26/96  11:01 PM
      2:   Monday Jul 27 14:00 1996  (seems to be more compatable with javascript parsing)
      3:   Monday Jul 27 at 6 AM
      4:   6:05 AM on Monday, Jul 27
      5:   6:05 AM
      6:   Mon, Jul 27
      7:   Mon 01:02PM 
      8:   6:05 (skip the AM PM)
      9:   04/14/97 10:28 PM 
     10:   year_month, with leading 0, so log files are sorted ok (e.g. 97_01)
     11:   01/31/98 (mm/dd/yy)
     12:   04/14/97 14:28:00 
     13:   14:28:33
     14:   Mon 04/14/99 14:28:00
     15:   Sunday, December 25th
     16:   04/14/97  2:28:00 PM</PRE>
<P>The second argument can be either time (in epoc seconds) or a file, where it will 
use the time that it was last modified.  The default is $Time (current time).</P>
<PRE>
    $lcd_data{1} = &amp;time_date_stamp(14, $Time);</PRE>
<PRE>
    speak &quot;File was changed today&quot; if time_date_stamp(6, $file) eq time_date_stamp(6);</PRE>
<P>Note: The mh.ini time_format and date_format parms can be used to modify these formats
to non-us standards (e.g. no AM/PM, use dd/mm instead of mm/dd).</P>
<P></P>
<DT><STRONG><A NAME="item_time_cron">time_cron</A></STRONG><BR>
<DD>
The cron time format matches the unix cron format.
<PRE>
    Cron Format:
      minutes hours day_of_month month day_of_week
</PRE>
<PRE>

        minutes: 0-59
        hours:   0-23
        dom:     1-31  (day of month)
        month:   1-12
        dow:     0-6   (day of week 0=Sunday 6=Saturday)</PRE>
<PRE>
      You can use a comma delimited list for any of these fields.  * matches all values.</PRE>
<P>By default time_cron only operates on the pass when a new minute starts.
This can be overridden if the parameter 1 is added - this may be useful if a
movement sensor is to trigger different events at different times.</P>
<PRE>
   Examples:</PRE>
<PRE>
                 # Speak time every 15 minutes, between 7 am and 8:45 am on weekdays only  
    speak $Time_Now  if time_cron '0,15,30,45 7,8 * * 1-5';</PRE>
<PRE>
                 # Change PA speaker mode at 9 pm, every day
    pa_sleep_mode('kids', 1) if time_cron '* 21 * * * ';</PRE>
<PRE>
    if (state_now $movement_sensor eq ON and !$Save{woken_up} and
        time_cron('* 6-9 * * 1', 1) )  {
       speak &quot;It is Monday morning. Remember to put the rubbish out.&quot;;
       $Save{woken_up} = 1;
    }</PRE>
<P></P>
<DT><STRONG><A NAME="item_time_greater_than">time_greater_than</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_time_greater_or_equal">time_greater_or_equal</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_time_less_than">time_less_than</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_time_less_or_equal">time_less_or_equal</A></STRONG><BR>
<DD>
These return true if the specified time is greater, less than, or equal to the current time.  Format can have the
same sorts of offsets as described in time_now below.  Note unlike time_now which is only true once,
these functions will return a true value for every pass that they are true.
<PRE>
   Example: curtain_on('bedroom', OPEN) if 
                    time_cron('22 6 * * 1-5') and 
                    time_greater_than(&quot;$Time_Sunrise + 0:15&quot;);</PRE>
<P></P>
<DT><STRONG><A NAME="item_time_now">time_now</A></STRONG><BR>
<DD>
time_now is evaluate to true for the 1 pass that matches the specified time/date.  Date is optional.
You can specify + or - offset, in hours:minutes:seconds.  Time can include AM/PM or be in 24 hour 
format.  The best way to see how it works is to look the following examples:
<PRE>
   Examples:</PRE>
<PRE>
     run_voice_cmd 'close the living room curtains'  if time_now $Time_Sunset;
     set $backyard_light ON if time_now(&quot;$Time_Sunset + 0:15&quot;);
     set $left_bedroom_light +50 if $Weekday and time_now &quot;$wakeup_time - 0:01&quot;;
     speak &quot;Remember dentist appointment&quot; if time_now '5/27/98 8:15 AM';
     run('min', 'IR_cmd VCR,4,RECORD') if time_now '2/07 18:00';
     run('min', 'IR_cmd VCR,STOP') if time_now &quot;$date $stop - 00:02&quot;;</PRE>
<P></P>
<DT><STRONG><A NAME="item_time_random">time_random</A></STRONG><BR>
<DD>
Use time_random to code random events.  It uses the same time format as time_cron,
but includes frequency parameter that specifies how often the event should trigger.
Frequency is the average number of minutes between occurrences.
<PRE>
  Usage:
     time_random($cron_spec, $frequency)</PRE>
<PRE>
  Examples:</PRE>
<PRE>
              # Speak something goofy once an hour on weekends
    speak(read_next $april_fools) if time_random('* 8-22 * * 0,6', 60);</PRE>
<PRE>
              # Toggle a light on an off randomly every 30 minutes
    if (time_random('* 18-22 * * *', 30)) {
      $state = (ON eq state $bedroom_light) ? OFF : ON;
      set $bedroom_light $state;
    }</PRE>
<P></P></DL>
<P>
<H2><A NAME="list of tk widget functions">List of tk widget functions</A></H2>
<DL>
<DT><STRONG><A NAME="item_tk_button_tk_mbutton">tk_button tk_mbutton</A></STRONG><BR>
<DD>
Use these functions to add a Tk button widget to the mh tk grid (tk_button) or the tk menu_bar (tk_mbutton).
&amp;tk_button will accept multiple variables, displaying them in a row in the grid.
<PRE>
   Usage:
    &amp;tk_mbutton('Button Name', \&amp;subroutine);
    &amp;tk_button('Button1', \&amp;sub1);
    &amp;tk_button('Button1', \&amp;sub1, 'Button2', \&amp;sub2,'Button3', \&amp;sub3);</PRE>
<PRE>
   Examples:</PRE>
<PRE>
    &amp;tk_mbutton('Help', \&amp;help);
    &amp;tk_button('Reload(F1)', \&amp;read_code, 'Pause (F2)', \&amp;pause,
               ' Exit (F3) ', \&amp;sig_handler, 'Debug(F4)',  \&amp;toggle_debug,
               'Log(F5)', \&amp;toggle_log);</PRE>
<P></P>
<DT><STRONG><A NAME="item_tk_checkbutton">tk_checkbutton</A></STRONG><BR>
<DD>
tk_checkbutton adds a Tk checkbutton widget to the mh tk grid.
It will accept multiple variables, displaying them in a row in the grid.
<PRE>
   Usage:
    &amp;tk_checkbutton('text',  \&amp;var1);
    &amp;tk_checkbutton('test1', \&amp;var1, 'text22', \&amp;var22, 'text3', \&amp;var33);</PRE>
<PRE>
   Examples:</PRE>
<PRE>
    &amp;tk_checkbutton('Debug on', \$config_parms{debug});
    &amp;tk_checkbutton('Sleeping Parents', \$Save{sleeping_parents}, 
                    'Sleeping Kids', \$Save{sleeping_kids});</PRE>
<P></P>
<DT><STRONG><A NAME="item_tk_entry">tk_entry</A></STRONG><BR>
<DD>
Use this function to allow for arbitrary data to be entered via the mh tk grid.
<PRE>
   Usage:
    &amp;tk_entry('Entry label:', $state_based_object);
    &amp;tk_entry('Entry label:', \$variable);
    &amp;tk_entry('Entry label:', \$variable, 'Entry label2:, \$variable2);</PRE>
<PRE>
   Example:
    &amp;tk_entry('Sleep time:', \$Loop_Sleep_Time);
    &amp;tk_entry('Test in 1', \$Save{test_input1}, 'Test in 2', \$Save{test_input2});</PRE>
<P></P>
<PRE>

Note:  The $variable reflects the data, as it is being entered.  If you want to test on the data
only after the RETURN key has been hit, use %Tk_results array.
The $variable is copied to $Tk_results{'Entry label:'} only after the RETURN key has been entered.</PRE>
<P>Now you can now also use a state based object (like Generic_Item) to store/monitor/change the tk_entry text.</P>
<PRE>
   Examples:</PRE>
<PRE>
    &amp;tk_entry('TV search', \$Save{tv_search});
    if ($state = $Tk_results{'TV search'}) {
       run qq[get_tv_info -times all -keys &quot;$state&quot;];
       set_watch $f_tv_file;
       undef $Tk_results{'TV search'};
    }</PRE>
<PRE>
   $mp3_search_text =  new Generic_Item;
   $mp3_search_text -&gt; tie_event('print_log &quot;mp3 search text is now $state&quot;');
   &amp;tk_entry('mp3 Search', $mp3_search_text);</PRE>
<P></P>
<DT><STRONG><A NAME="item_tk_label_tk_mlabel">tk_label tk_mlabel</A></STRONG><BR>
<DD>
Use these functions to add a Tk label widget to the mh tk grid (tk_label) or the tk menu_bar (tk_mlabel).
&amp;tk_label will accept multiple variables, displaying them in a row in the grid.
<PRE>
   Usage:
</PRE>
<PRE>

     &amp;tk_mlabel(\$variable);
     &amp;tk_label(\$variable);
     &amp;tk_label(\$variable1, \$variable2, \$variable3);</PRE>
<PRE>
   Example:</PRE>
<PRE>
     &amp;tk_mlabel(\$Save{email_flag});
     $Save{email_flag} = file_read &quot;$Pgm_Root/data/get_email.flag&quot;;</PRE>
<P></P>
<DT><STRONG><A NAME="item_tk_radiobutton">tk_radiobutton</A></STRONG><BR>
<DD>
Use this function to create radio buttons in the mh tk grid.  If labels are not specified, the values are displayed.
<PRE>
   Usage:
    &amp;tk_radiobutton('Button label:', $state_based_object, ['value1', 'value2', 'value3']);
    &amp;tk_radiobutton('Button label:', \$variable, ['value1', 'value2', 'value3']);
    &amp;tk_radiobutton('Button label:', \$variable, ['value1', 'value2', 'value3'], 
                                                 ['label1', 'label2', 'label3']);</PRE>
<PRE>
   Examples:</PRE>
<PRE>
    &amp;tk_radiobutton('Mode',  \$Save{mode}, ['normal', 'mute', 'offline']);
    &amp;tk_radiobutton('Debug', \$config_parms{debug}, [1, 0], ['On', 'Off']);
    &amp;tk_radiobutton('Tracking', \$config_parms{tracking_speakflag}, [0,1,2,3],
                    ['None', 'GPS', 'WX', 'All']);</PRE>
<PRE>
    my $alarm_states = &quot;Disarmed,Disarming,Arming,Armed,Violated,Exit Delay,Entry Delay&quot;;
    my @alarm_states = split ',', $alarm_states;
    $alarm_status    = new Generic_Item;
    &amp;tk_radiobutton('Security Status', $alarm_status, [@alarm_states]);</PRE>
<PRE>
    $v_alarm_status  = new Voice_Cmd &quot;Set the alarm to [$alarm_states]&quot;;
    $v_alarm_status -&gt; tie_items($alarm_status);</PRE>
<PRE>
    print_log &quot;Alarm status changed to $state&quot; if $state = state_now $alarm_status;</PRE>
<P></P></DL>
<P>See mh/code/examples/tk_examples.pl for more tk_*  examples.</P>
<P>
<H2><A NAME="list of internet functions">List of Internet functions</A></H2>
<DL>
<DT><STRONG><A NAME="item_get">get</A></STRONG><BR>
<DD>
This function will retrieve data from the web (http web pages or ftp files).
If the web page is large or the site is slow, you may want to use a Process_Item
call to the get_url program, so the request can be done as a separate process
and mh will not get hung up while waiting.
<PRE>
  Examples:</PRE>
<PRE>
    my $html = get '<A HREF="http://marketing.cbs.com/lateshow/topten">http://marketing.cbs.com/lateshow/topten</A>';</PRE>
<PRE>
    Other examples are in mh/code/bruce/internet_data.pl</PRE>
<P></P>
<DT><STRONG><A NAME="item_get_ip_addresses">get_ip_addresses</A></STRONG><BR>
<DD>
Returns the numeric IP address of the specified hostname.  If hostname is blank, localhost is used. 
If used in a list context, all associated IP address are returned (e.g. dial up address and local address).
<PRE>
  Examples:</PRE>
<PRE>
    print_log &quot;Current IP address &quot; . get_ip_address;</PRE>
<PRE>
                       #  Echo dynamic IP address to the Tk gui
    if ($New_Minute and net_connect_check) {
         $Tk_objects{ip_address} = &quot;IP address: &quot; . get_ip_address;
    }   
    tk_label(\$Tk_objects{ip_address});</PRE>
<P></P>
<DT><STRONG><A NAME="item_html_unescape">html_unescape</A></STRONG><BR>
<DD>
Un-escapes ``%xx'' data back into the original characters.  Use on HTML FORM data.
<P></P>
<DT><STRONG><A NAME="item_new_second">new_second</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_new_minute">new_minute</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_new_hour">new_hour</A></STRONG><BR>
<DD>
These functions are like the $New_Second/Minute/Hour variables, except they can return true 
only on the nth second/minute/hour.
<PRE>
  Examples:</PRE>
<PRE>
    print_log &quot;This occurs every 10th second&quot; if new_second 10;
    print_log &quot;This occurs once every even hour&quot; if new_second 2;</PRE>
<P>If you pass no argument, it defaults to 1 (i.e. the same as the $New_* variables).</P>
<P></P>
<DT><STRONG><A NAME="item_net_domain_name_%27address%27">net_domain_name 'address'</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_net_domain_name_start_%27search_name%27%2C_%27addr">net_domain_name_start 'search_name', 'address'</A></STRONG><BR>
<DD>
<DT><STRONG><A NAME="item_net_domain_name_done_%27search_name%27">net_domain_name_done  'search_name'</A></STRONG><BR>
<DD>
These functions will return the domain_name of the last client to access the specified port.
If the mh.ini DNS_server parm is NOT set, it will return the IP address instead.
You can also pass it an IP address, instead of a server port name.
<P>If used in an array context, it returns the full domain name, and a short version
of the domain name (e.g. 'www.ibm.com' and 'ibm').</P>
<P>If you call net_domain_name_start, then check for net_domain_name_done,
it will query the DNS servers as a background task,
so mh will not pause if the DNS server response takes a while.
The 'search_name' string must be unique for that part of the code, so
that the net_domain_name_done test gets the correct results.</P>
<PRE>
  Examples:</PRE>
<PRE>
                           # Run in the foreground
   my $domain_name = net_domain_name 'http';
   my ($name, $name_short) = net_domain_name 'server_speak';
   my ($name, $name_short) = net_domain_name '204.146.18.33';
#  Results: $name = 'www.ibm.com', $name_short = 'ibm';</PRE>
<PRE>
                           # Run in the background
  $v_test_dns2  = new Voice_Cmd 'Run the dns test2';
  $v_test_dns2 -&gt; tie_event(&quot;net_domain_name_start 'test', '204.146.18.33'&quot;);
  print_log &quot;Domain=$state&quot; if $state = net_domain_name 'test';</PRE>
<P></P>
<DT><STRONG><A NAME="item_net_ping">net_ping</A></STRONG><BR>
<DD>
Checks to see if an IP address is available.    Returns true if pingable.
<PRE>
  Example:
</PRE>
<PRE>

    &amp;ping($host);           #  Default protocol is specified in mh.ini
    &amp;ping($host, $protocol);</PRE>
<P></P>
<DT><STRONG><A NAME="item_net_ftp">net_ftp</A></STRONG><BR>
<DD>
Used to ftp data to or from an ftp server.  There is also a stand alone version of this command
in mh/bin/net_ftp, so you can run this command with a run or a Process_Item to avoid
hanging mh with long running ftp sessions.
<PRE>
  Usage:</PRE>
<PRE>
    net_ftp(option1 =&gt; $value1, option2 =&gt; value2 ...);
</PRE>
<PRE>

       These are the possible options:</PRE>
<PRE>
            server          Default is mh.ini parm net_www_server
            user            Default is mh.ini parm net_www_user
            password        Default is mh.ini parm net_www_password
            dir             Default is mh.ini parm net_www_dir
            file            Name local/remote file to get/put
            file_remote     Name of remote file (if different from local file)
            command         get/put/delete.
            type            ascii/binary  (default is ascii)
            passive         Set to 1 to get a passive FTP (sometimes needed for firewalls)</PRE>
<PRE>
   Example:</PRE>
<PRE>
     net_ftp(file =&gt; 'index.html', command =&gt; 'put', passive =&gt; 1);</PRE>
<PRE>
     my $rc = net_ftp(
        file =&gt; 'c:/junk1.txt', file_remote =&gt; 'incoming/junk1.txt',
        command =&gt; 'put', server =&gt; 'misterhouse.net',  
        user =&gt; 'anonymous', password =&gt; 'bruce@misterhouse.net');
     print_log &quot;net_ftp put results: $rc&quot;;</PRE>
<P></P>
<PRE>

    $v_test_ftp = new Voice_Cmd 'Test background ftp [get,put]';
    $p_test_ftp = new Process_Item;
    if ($state = said $v_test_ftp) {
      set $p_test_ftp
          &quot;net_ftp -file c:\junk1.txt -file_remote incoming/junk1.txt &quot; . 
          &quot;-command $state -server misterhouse.net &quot; . 
          &quot;-user anonymous -password bruce\@misterhouse.net&quot;;
      start $p_test_ftp;
    }
    print_log &quot;Ftp command done&quot; if done_now $p_test_ftp;</PRE>
<P></P>
<DT><STRONG><A NAME="item_net_connect_check">net_connect_check</A></STRONG><BR>
<DD>
Returns true if connected to the Internet.  If the mh.ini parm net_connect=persistent, this always 
returns true.
<P></P>
<DT><STRONG><A NAME="item_net_jabber_send_or_net_im_send">net_jabber_send or net_im_send</A></STRONG><BR>
<DD>
Used to send and AOL Instant Message or Jabber message across the internet.
<P>Information on AIM clients (available for various different platforms)
can be found at <A HREF="http://www.aol.com/aim/faq/getstarted.html">http://www.aol.com/aim/faq/getstarted.html</A> . 
Tik, a tk based client for use on a Unix os, can be found at <A HREF="http://tarp.linuxos.org/tik">http://tarp.linuxos.org/tik</A> .
You can register for an AIM name at <A HREF="http://www.aol.com/aim/faq/registration.html">http://www.aol.com/aim/faq/registration.html</A> .</P>
<P>Information on Jabber clients (many open sourced clients are available for different platforms AND the protocol is open)
can be found at <A HREF="http://www.jabber.com">http://www.jabber.com</A> and <A HREF="http://www.jabbercentral.org.">http://www.jabbercentral.org.</A></P>
<P></P>
<PRE>

  Usage:
    net_jabber_send(option =&gt; value);
    net_im_send(option =&gt; value);</PRE>
<PRE>
     These are the options:</PRE>
<PRE>
        password    Default is mh.ini parm net_jabber_password  or net_aim_password
        from        Default is mh.ini parm net_jabber_name      or net_aim_name
        to          Default is mh.ini parm net_jabber_name_send or net_aim_name_send
        server      Default is mh.ini parm net_jabber_server (e.g. jaber.com)
        resource    Default is mh.ini parm net_jabber_resource (this can be left blank)</PRE>
<PRE>
        text        Message
        file        Message.  You can use the text and/or file options.</PRE>
<P>The first time you send a message, mh will pause for a few seconds while it logs onto AIM or a jabber server.
Subsequent messages use the same signon, so are sent much faster.</P>
<P>Once you have been logged in, mh will also display incoming jabber messages.  This code has lots of
other possibilites that can be added, since jabber is XML based and very flexable.</P>
<PRE>
  Example:</PRE>
<PRE>
    net_jabber_send(text =&gt; &quot;Stock summary\n  $Save{stock_data1}\n  $Save{stock_data2}&quot;)</PRE>
<PRE>
    net_im_send(text =&gt; &quot;Internet mail summary for $Date_Now $Time_Now&quot;,
                file =&gt; &quot;$config_parms{data_dir}/get_email2.txt&quot;) if time_cron '05 12 * * 1-5';</PRE>
<P></P>
<P></P>
<DT><STRONG><A NAME="item_net_mail_send">net_mail_send</A></STRONG><BR>
<DD>
Used to send email.
To run commands via email, see FAQ question 2.12: Can do I send mh comands via email?
<P></P>
<PRE>

  Usage:
    net_mail_send(option =&gt; value);</PRE>
<PRE>
     These are the options:</PRE>
<PRE>
        server      Default is mh.ini parm net_mail_ACCOUNT_server
        from        Default is mh.ini parm net_mail_ACCOUNT_address
        to          Default is mh.ini parm net_mail_ACCOUNT_address</PRE>
<PRE>
        account     This is the ACCOUNT field used in finding the above parms.
                    It defaults to the mh.ini parm net_mail_send_account.</PRE>
<PRE>
        subject     Default is 'Email from Mister House'
        text        Body of the message</PRE>
<PRE>
        file        File with the body of the message or a file whose
                    contents you want attached to the note.
        filename    Name to give file attachement.  Defaults to file parm.</PRE>
<PRE>
        mime        Set to the mime type (used if a file is attached).
                    Current recognized types are txt,pl,zip,bin,exe,jpg,gif,png, and html.
                    If not specified, the extention of the file parm is used.
                    Use bin for an arbitary binary file.</PRE>
<PRE>
        baseref     If sending html with mime =&gt; 'html', use this to set the BASE HREF</PRE>
<PRE>
  Example:</PRE>
<PRE>
    net_mail_send(text =&gt; &quot;Test email sent at $Time_Now\n\n&quot;);</PRE>
<PRE>
    net_mail_send(account =&gt; 'Bruce', to =&gt; 'winter@misterhouse.net', text =&gt; $msg);</PRE>
<PRE>
    net_mail_send(subject =&gt; 'test an html file attachement',
                  baseref =&gt; 'localhost:8080',
                  file    =&gt; '../web/mh4/widgets.html', mime  =&gt; 'html');</PRE>
<PRE>
    net_mail_send(subject =&gt; 'test a gif file attachement',
                  file    =&gt; '../web/graphics/goofy.gif');</PRE>
<P></P>
<DT><STRONG><A NAME="item_net_mail_count">net_mail_count</A></STRONG><BR>
<DD>
Returns the number of email message on the specified account.
<PRE>
  Usage:
    net_mail_count(option =&gt; value);</PRE>
<PRE>
     These are the options:</PRE>
<PRE>
        server      Default is mh.ini parm net_mail_ACCOUNT_server
        user        Default is mh.ini parm net_mail_ACCOUNT_user
        password    Default is mh.ini parm net_mail_ACCOUNT_password</PRE>
<PRE>
        account     This is the ACCOUNT field used in finding the above parms.
                    It defaults to the mh.ini parm net_mail_send_account.</PRE>
<PRE>
  Example:</PRE>
<PRE>
    my $count = net_mail_count(account =&gt; 'Bruce');
    speak &quot;Email account Bruce has $count new email messages&quot;;</PRE>
<P></P>
<DT><STRONG><A NAME="item_net_mail_summary">net_mail_summary</A></STRONG><BR>
<DD>
This returns a pointer to a hash array containing info on mail for a specified email account. 
Check out the mh/bin/get_email program for a usage example.  Rather than call this 
with mh code directly, calling get_email with a Process_Item, so mh does not pause
while email is being checked.  See mh/code/test/internet_mail.pl for an example.
<P></P>
<P></P>
<DT><STRONG><A NAME="item_net_mail_read">net_mail_read</A></STRONG><BR>
<DD>
Returns a list array of pointers to data read from an email account.
This is not tested and needs to be documented.
<P></P>
<P></P></DL>
<P>
<H2><A NAME="list of companion programs">List of companion programs</A></H2>
<P>These programs are included in mh mh/bin directory.  Most of these are meant to be called from mh events,
as separate processes, but they can also be run stand alone.  You can get the help text for
most of these programs with the -h option (e.g. get_tv_grid -h).</P>
<DL>
<DT><STRONG><A NAME="item_alpha_page">alpha_page</A></STRONG><BR>
<DD>
<PRE>
  alpha_page sends alphanumeric page.</PRE>
<PRE>
  Usage:</PRE>
<PRE>
    alpha_page [options]</PRE>
<PRE>
      -h              =&gt; This help text
      -help           =&gt; This help text
      -name xxx       =&gt; name of recipient (must be defined in mh.ini)
      -pin xxx        =&gt; pin number
      -message xxx    =&gt; text of message to send</PRE>
<PRE>
  Example:
    alpha_page -pin 123456 -message 'Bring home bread and milk'
    alpha_page -name craig -message 'Bring home bread and milk'</PRE>
<DT><STRONG><A NAME="item_backup_data">backup_data</A></STRONG><BR>
<DD>
backup_data walks directories and stores selected files to gziped tar files.
<PRE>
  Usage:</PRE>
<PRE>
   backup_data [options] dir1 dir2 etc</PRE>
<PRE>
    -h        =&gt; This help text</PRE>
<PRE>
    -file xyz =&gt; Name of tar file.  Default is backup
    -size xyz =&gt; Do NOT store files &gt; xyz KBytes.  Default is 100
    -skip xyz =&gt; Skip any file or dir that matches regex xyz
    -age  xyz =&gt; Only back up files changed in the last xyz days</PRE>
<PRE>
    -no_zip   =&gt; Do NOT gzip the tar file.
    -no_zip   =&gt; Do NOT suffix the files with date stamp.</PRE>
<PRE>
    -int      =&gt; Use the internal perl tar and gzip modules, rather
                 then external tar and gzip programs.  This is slower
                 and users more memory (&gt; the data being tared).</PRE>
<PRE>
  Examples:
    backup_data /www
    backup_data -size 10 -no_zip -int /usr/local/bin
    backup_data -file /backup/misc /bin //misterhouse.net/bin
    backup_data -file /backup/mh -skip &quot;(/tv$)|(/articles$)&quot; /misterhouse
    backup_data -file /backup/mh_articles  -size 100000 /misterhouse/articles
    backup_data -file /backup/docs -age 30 -size 100000 /docs</PRE>
<P></P>
<DT><STRONG>display</STRONG><BR>
<DD>
Use this to display a string of text or the contents of a file using a Tk window.
<PRE>
  Usage:
     display -options  text_or_file</PRE>
<PRE>
  Options:
    -time  xxx to have the window auto-close in xxx seconds.  Set to 0 for no auto-close.
    -font  xxx to pick the font
    -title xxx to set the window title</PRE>
<PRE>
  Examples:
    display weather_forcast.txt
    display -title 'triva answer' c:/data/triva_answer.txt
    display &quot;Remember to take out the garbage&quot; -time 0</PRE>
<P></P>
<DT><STRONG><A NAME="item_display_callers">display_callers</A></STRONG><BR>
<DD>
Use this to display a Tk window with a list of the incoming and outgoing phone logs.
An example of how to create these logs is in mh/code/bruce/phone.pl
<PRE>
  Usage: 
    display_callers (no argument -&gt; uses latest logs) 
    display_callers 1997_11  (Look only at November, 1997 logs)</PRE>
<P></P>
<DT><STRONG><A NAME="item_find_files">find_files</A></STRONG><BR>
<DD>
find_files finds files on shared networked Windows and samba directories
<PRE>
  Usage:
   find_files [options] search_string</PRE>
<PRE>
    -h or -help  =&gt; This help text
    -v           =&gt; Verbose (shows dirs as they are searched)</PRE>
<PRE>
    -boxes x,y,z =&gt; Search for files on boxes x,y, and z.  Defaults to all.
    -dirs  x,y,z =&gt; Search only dirs x,y, and z.  Defaults to all.
    -skip  x,y,z =&gt; Ignore files/dirs with strings x,y, and z.</PRE>
<PRE>
  Examples:
    find_files mp3
    find_files -v -boxes &quot;house,dm,c2&quot; mp3
    find_files -dirs &quot;//house/c,//dm/d&quot; mp3</PRE>
<P></P>
<DT><STRONG><A NAME="item_find_programs">find_programs</A></STRONG><BR>
<DD>
find_programs finds programs running on networked Windows computers.
<P>Requires WMI to be installed on both/all computers.</P>
<PRE>
  Usage:
   find_programs [options] box_list [search_string]</PRE>
<PRE>
    box_list is a comma delimited list of boxes to search
    search_string lists only programs that match</PRE>
<PRE>
   options:
    -h or -help  =&gt; This help text
    -all         =&gt; Show/search all programs</PRE>
<PRE>
  Examples:
    find_programs house
    find_programs &quot;house,dm,c2&quot; quake
    find_programs -all &quot;house,dm,c2&quot;</PRE>
<P></P>
<DT><STRONG><A NAME="item_get_ceiva">get_ceiva</A></STRONG><BR>
<DD>
get_ceiva gets pictures from the 'now showing' folder of a Ceiva.com web page.
<PRE>
  Usage: 
   get_ceiva [options]</PRE>
<PRE>
    -h        =&gt; This help text</PRE>
<PRE>
    -username xyz =&gt; xyz is a ceiva member name
    -password xyz =&gt; xyz is a ceiva password
    -frame_id xyz =&gt; xyz is a ceiva frame_id</PRE>
<PRE>
    -outdir xyz   =&gt; xyz the directory the pictures will be put in
    -browser xyz  =&gt; xyz is the path to your html browser
    -reget        =&gt; Re-fetch the files, even if they look current</PRE>
<PRE>
  Examples:
    get_ceiva -outdir /pictures/ceiva
    get_ceiva -reget</PRE>
<P></P>
<DT><STRONG><A NAME="item_get_email">get_email</A></STRONG><BR>
<DD>
Use this program to check all the email accounts defined in your mh.ini file.  
It will create the following files:
<PRE>
  mh/data/get_email.data 
     It uses this database so see what email is new
     since it was last called.   To get a complete
     list of all email (not just new/recent mail).
     delete this file before running get_email</PRE>
<PRE>
  mh/data/get_mail.txt 
     This summarizes how much mail there is and from who.
     Here is an example of what the file might look like:</PRE>
<PRE>
       Email account bruce has 2 new email messages from John Doe and Bill Gates</PRE>
<PRE>
  mh/data/get_mail.flag
     This has a string of digits, one for each account,
     that shows how much mail is each account.</PRE>
<PRE>
  mh/data/email
     This directory will have one weeks worth of html mail files, 
     by account and day (e.g. winter_tue.html), as well as a
     latest.html file that just shows the unreceived mail.</PRE>
<P>You can create a get_email_rule.pl file to control how this program summarizes
mail.  See get_email_rule_example.pl for an example.</P>
<P>Use the mh.ini net_mail_scan_age parm to set the age, in minutes, of email to report/scan.
If blank, (default), get_email reports on all mail on your server.
If your have your mail client set to 'leave mail on server'
(useful if you want to use appliances like Audrey to also read mail),
you will probably want to set this to something like 15.</P>
<P>Here is an example of how to call it from mh (see mh/code/test/internet_mail.pl 
for the complete example):</P>
<PRE>
  $p_get_email = new Process_Item('get_email');
  start $p_get_email if !$Save{sleeping_parents} and 
                        $New_Minute and !($Minute % 20) and &amp;net_connect_check;</PRE>
<PRE>
  if (done_now $p_get_email) {
      my $email_text = file_read &quot;$Pgm_Root/data/get_email.txt&quot;;
      speak &quot;rooms=all $email_text&quot; if $email_text;
      $Save{email_flag} = file_read &quot;$Pgm_Root/data/get_email.flag&quot;;
  }
  &amp;tk_mlabel(\$Save{email_flag});</PRE>
<P></P>
<DT><STRONG><A NAME="item_get_mp3_data">get_mp3_data</A></STRONG><BR>
<DD>
get_mp3_data reads mp3 directories and stores the results in a dbm file.
This data is used by mh/test/mp3_playlist/pl to search/play mp3 
tag data, file names, and playlist files.
<PRE>
  Usage:</PRE>
<PRE>
   get_mp3_data [options] dir1 dir2 etc</PRE>
<PRE>
    -h        =&gt; This help text
    -help     =&gt; This help text</PRE>
<PRE>
    -dbm  xyz =&gt; Stores the data in dbm file xyz.</PRE>
<PRE>
  Examples:
    get_mp3_data c:\mp3 d:\mp3
    get_mp3_data -dbm e:\mh\data\mp3_dbm c:\mp3</PRE>
<P></P>
<DT><STRONG><A NAME="item_get_tv_grid">get_tv_grid</A></STRONG><BR>
<DD>
get_tv_grid gets a TV grid/schedule from the web (clicktv.com) and changes so
it to be used by the MisterHouse program to create VCR and TV event reminders.
Creates a DBM for use by get_tv_info.
<PRE>
  Usage:
   get_tv_grid [options]
    -h        =&gt; This help text
    -help     =&gt; This help text
    -userid xyz   =&gt; xyz is your clicktv userid.  Go to <A HREF="http://clicktv.com">http://clicktv.com</A>  to
                     create one, or to find the generic one that matches your
                     local tv schedule.
    -day xyz      =&gt; xyz is the day  to get/filter.  Default is today.
    -hour xyz     =&gt; xyz is the hour to get/filter.  Default is 6pm.  Can also
                     be 'all' to get all hours.
    -days xyz     =&gt; xyz is the number of days to get/filter, starting
                     with -day.
    -channels xyz =&gt; xyz is the number of channels to filter.  Default is 999.
    -infile  xyz  =&gt; xyz is  original input file.   Default is
                     web/tv/clicktv/day_hour.html.  If this file is missing
                     or old, a new file will be retrieved from the web.
    -outfile xyz  =&gt; xyz the filtered output file.
                     Default is -outdir/day_hour.html
    -outdir  xyz  =&gt; xyz the directory the outfiles will be put in.
                     Default is mh.ini parm html_dir/tv
    -label xyz    =&gt; Use xyz as the link lable.  Default is &quot;VCR&quot;.
    -reget        =&gt; Re-read  the clicktv web page, even if a recent file it
                     already exists.
    -redo         =&gt; Re-write -outfile xyz, even if it already exists.
    -keep_old     =&gt; Do NOT delete data from the DBM that is one month older
                     than todays date
    -debug        =&gt; turn on debug info</PRE>
<PRE>
    -mail_to      xyz =&gt; Will email the charts to xyz
    -mail_server  xyz =&gt; xyz is the SMTP host.  Default is localhost
    -mail_baseref xyz =&gt; xyz is the http address of your mh server.  Needed if
                         you want to control mh from the emailed web page
  Example:
    get_tv_grid -day 25 -hour 4pm -outfile my_tv.html
    get_tv_grid -days 7 -hour all
    get_tv_grid -email bruce@misterhouse.net -mail_baseref misterhouse.net:8080</PRE>
<PRE>
  Usage:
    get_tv_grid [options]</PRE>
<PRE>
  Options:
    -h        =&gt; This help text
    -help     =&gt; This help text</PRE>
<PRE>
    -zip xyz      =&gt; xyz is your zip code
    -provider xyz =&gt; xyz is your TV provider ID.  See note below</PRE>
<PRE>
    -day xyz      =&gt; xyz is the day  to get/filter.  Default is today.
    -hour xyz     =&gt; xyz is the hour to get/filter.  Default is 6pm.
                     Can also be 'all' to get all hours.</PRE>
<PRE>
    -days xyz     =&gt; xyz is the number of days to get/filter, starting with -day.</PRE>
<PRE>
    -channels xyz =&gt; xyz is the number of channels to filter.  Default is 999.</PRE>
<PRE>
    -infile  xyz  =&gt; xyz is  original input file.   Default is web/tv/clicktv/day_hour.html
                     If this file is missing or old, a new file will be retreived from
                     the web.</PRE>
<PRE>
    -outfile xyz  =&gt; xyz the filtered output file. 
                     Default is -outdir/day_hour.html</PRE>
<PRE>
    -outdir  xyz  =&gt; xyz the directory the outfiles will be put in.
                     Default is mh.ini parm html_dir/tv</PRE>
<PRE>
    -label xyz    =&gt; Use xyz as the link lable.  Default is &quot;Set the Vcr&quot;</PRE>
<PRE>
    -reget        =&gt; Re-read  the clicktv web page, even if a recent file it already exists.
    -redo         =&gt; Re-write -outfile xyz, even if it already exists.</PRE>
<PRE>
    -debug        =&gt; turn on debug info</PRE>
<PRE>
    -mail_to      xyz =&gt; Will email the charts to xyz
    -mail_server  xyz =&gt; xyz is the SMTP host.  Default is localhost
    -mail_baseref xyz =&gt; xyz is the http address of your mh server.  Needed if you want to
                         control mh from the emailed web page</PRE>
<PRE>
  Examples:
    get_tv_grid -day 25 -hour 4pm -outfile my_tv.html
    get_tv_grid -days 7 -hour all
    get_tv_grid -email bruce\@misterhouse.net -mail_baseref misterhouse.net:8080</PRE>
<PRE>
  Note on finding your provider ID:
   Enter your zip code at <A HREF="http://tvlistings2.zap2it.com/">http://tvlistings2.zap2it.com/</A>
   View the html source and pick the number from value='nnnnnn'
   by doing a string search for you provider.  For example:
      &lt;OPTION value=&quot;255248&quot;&gt;Charter Communications - Rochester&lt;/OPTION&gt;</PRE>
<P></P>
<DT><STRONG><A NAME="item_get_tv_info">get_tv_info</A></STRONG><BR>
<DD>
get_tv_info returns info about tv programs that match the requested parms.
It uses a database created by the get_tv_grid program.
See mh/code/bruce/tv_info.pl for examples on how to use this from mh.
<PRE>
  Version: 1.14</PRE>
<PRE>
  Usage:</PRE>
<PRE>
   get_tv_info [options]</PRE>
<PRE>
    -h        =&gt; This help text
    -help     =&gt; This help text</PRE>
<PRE>
    -channels  xyz =&gt; Will return info only for channel numbers xyz.
                      Default is all the channels found by get_tv_grid.
    -dates     xyz =&gt; Will return info only for dates xyz.
                      Default is today.  Format: month/day (e.g. 4/22).
    -times     xyz =&gt; Will return info only for shows that start at xyz.
                      Default is '6pm-10pm'.  Use 'all' for all hours.
                      Valid formats: 1 pm, 1PM, 13, 13:00.
    -early_am  xyz =&gt; Adds info for shows after midnight.
                      Formats are same as for to times.
    -increment xyz =&gt; Time increment is xyz minutes (5 or 30). Default is 5.
    -lengths   xyz =&gt; Will return info only for shows that are xyz hours long.
                      Default is any length.
    -keys      xyz =&gt; Will return info only for shows that have keywords
                      in the xyz list in their title or description.
                      Note: xyz can be a regular expresion (e.g. -keys &quot;^ER$&quot;)
    -keyfile   xyz =&gt; List of keys to search for, from a file in the data directory</PRE>
<PRE>
      All of the above parms support these formats:
         : comma-seperated values (e.g. -dates 7/4,7/5,7/6)
         : - delimited ranges     (e.g. -dates 7/4-7/6)
         : + adder spec           (e.g. -dates 7/4+2)
           Starting spec is optional (e.g. -dates +2)</PRE>
<PRE>
    -debug        =&gt; turn on debug info
    -quiet        =&gt; turn off normal errata</PRE>
<PRE>
  Examples:
    get_tv_info -channels &quot;4-12&quot; -lengths 2
    get_tv_info -channels &quot;4,6,12&quot; -times &quot;7 pm&quot;
    get_tv_info -dates &quot;7/4-7/11&quot; -keys &quot;star trek, er ,dilbert&quot;
    get_tv_info -dates +14 -keys computer
    get_tv_info -time &quot;17-23&quot;</PRE>
<PRE>
  Shows which have already started are excluded unless you search 
  without specifying -times or you search for -times 'all'.</PRE>
<P></P>
<DT><STRONG><A NAME="item_get_url">get_url</A></STRONG><BR>
<DD>
get_url gets a web page and echos it to STDOUT or a local file.
<PRE>
  Usage:
    get_url url [local_file]</PRE>
<PRE>
    If local_file is specified, data is stored there,
    otherwise it is echoed to STDOUT.</PRE>
<PRE>
  Examples:
    get_url <A HREF="http://marketing.cbs.com/lateshow/topten/">http://marketing.cbs.com/lateshow/topten/</A> $f_top10_html;</PRE>
<P></P>
<DT><STRONG><A NAME="item_get_weather">get_weather</A></STRONG><BR>
<DD>
get_weather gets weather info NOAA web servers.
<PRE>
  Usage:
    get_weather [options]</PRE>
<PRE>
  Options:
    -h         =&gt; This help text
    -help      =&gt; This help text</PRE>
<PRE>
    -city     xxx =&gt; xxx is the City  you want.
    -state    xxx =&gt; xxx is the State you want.</PRE>
<PRE>
    -data     xxx =&gt; xxx is either conditions, forecast, or all.  Default is all.</PRE>
<PRE>
    -refresh  xxx =&gt; xxx is the number of minutes old the cached data can
                     before it will be refreshed from the net. 
                     The default is 60 minutes.</PRE>
<PRE>
    -no_log       =&gt; Unless this option is used, the results also get filed 
                     into the mh/data/web directory</PRE>
<PRE>
  Example:
    get_weather -city Rochester -state MN</PRE>
<P>Here is an example mh event for calling get_weather as a background process using the 'run' function:</P>
<PRE>
  $v_get_internet_weather_data  = new  Voice_Cmd('Get internet weather data');
  $v_show_internet_weather_data = new  Voice_Cmd('Show internet weather data');
  if (said  $v_get_internet_weather_data) {
     run &quot;get_weather -city $config_parms{city} -state $config_parms{state}&quot;;
     set_watch $f_weather_forecast;
  }
  if (said  $v_show_internet_weather_data or changed $f_weather_forecast) {
     print_log &quot;Weather data displayed&quot;;
     display name $f_weather_forecast;
     display name $f_weather_conditions;
  }</PRE>
<P></P>
<DT><STRONG><A NAME="item_house">house</A></STRONG><BR>
<DD>
This is a simple shell that echos whatever you type into the 'xcmd_file'. 
The name of the 'xcmd_file' is specified in mh.ini.  If mh detects this
file, it will read and execute its contents, then delete it.
<PRE>
  Examples:
    house speak hi there
    house display c:\autoexec.bat
    house Turn the backyard light on
    house XAJAK</PRE>
<P></P>
<DT><STRONG><A NAME="item_ical_load">ical_load</A></STRONG><BR>
<DD>
ical_load reads an icalendar calendar file from the Unix ical program.
Optionally creates a mh code file to implement calendar events.
<P>See outlook_read for a Windows solution.</P>
<PRE>
  Version: 1.0</PRE>
<PRE>
  Usage:
    ical_load [options]</PRE>
<PRE>
  Options:
    -help    -&gt; help text</PRE>
<PRE>
    -calendar_file xyz-&gt; Location of .calendar file. It defaults to $HOME/.calendar.
    -quiet            -&gt; do not echo data to STDOUT
    -debug            -&gt; print out debug</PRE>
<PRE>
    -pl_file xyz      -&gt; Write out a mh perl code file.  These are the various
                         formats of Calendar subjects:</PRE>
<PRE>
                         vcr channel_num show_name (e.g. VCR 8 Dilbert)
                         voice_command  (e.g. Christmas lights on)
                         message_to_speak (e.g. Today is national geek day)</PRE>
<PRE>
                         Note:  If the text is not a vcr or voice_command, it
                                will be treated as a messages.</PRE>
<PRE>
    -date mm/dd/yy    -&gt; Get data with a start_time on date.  Default is today.
    -days ###         -&gt; Look out ### days from -date.  Default is none, today only.</PRE>
<PRE>
  Examples:
    ical_load -help
    ical_load -calendar_file /home/dbl/.calendar -pl_file /projects/mhcode/calendar_events.pl
    ical_load -calendar_file /home/dbl/.calendar -date 11/07/00 -days 2
    ical_load -calendar_file /home/dbl/mh/data/calendar
    ical_load</PRE>
<P></P>
<DT><STRONG><A NAME="item_mhl">mhl</A></STRONG><BR>
<DD>
A unix script you can use mhl to start mh (rather than calling mh directly) to help ensure that mh
will always be running.  This is a simple shell will restart mh if it detects
that mh exited abnormally.  You can pass in the same startup parms to mhl as you us for mh.
<P>On windows, this function is built into the mh.bat script.</P>
<P></P>
<DT><STRONG>net_ftp</STRONG><BR>
<DD>
net_ftp sends, receives, or deletes a file to remote site via ftp.
There is also an identical net_ftp function, if you want to call 
it directly from mh.
<PRE>
  Usage:
    net_ftp -option value -option value ...</PRE>
<PRE>
    Where -option can be any of the following
       server          Default is mh.ini parm net_www_server
       user            Default is mh.ini parm net_www_user
       password        Default is mh.ini parm net_www_password
       dir             Default is mh.ini parm net_www_dir</PRE>
<PRE>
       file            Name local/remote file to get/put
       file_remote     Name of remote file (if different from file)
       command         get/put/delete.
       type            ascii/binary  (default is ascii)</PRE>
<PRE>
  Example:
    net_ftp -command put -file junk1.txt -file_remote /tmp/junk1.txt</PRE>
<P></P>
<DT><STRONG><A NAME="item_outlook_read">outlook_read</A></STRONG><BR>
<DD>
outlook_read reads MS Outlook (a windows mail/calendar program) folder data
and optionally creates a mh code file to implement calendar events.
<P>See ical_load for a Unix solution.</P>
<PRE>
  Usage:
    outlook_read [options]</PRE>
<PRE>
  Options:
    -help    -&gt; help text</PRE>
<PRE>
    -version xyz -&gt; Version of Outlook.  Use 98 if you have Outlook 98.</PRE>
<PRE>
    -quiet       -&gt; do not echo data to STDOUT
    -debug       -&gt; print out debug</PRE>
<PRE>
    -folder xyz  -&gt; Get data from folder xyz.  It can be one of the following:
                      Deleted, Outbox, SentMail, Inbox, Calendar (default),
                      Contacts, Journal, Notes, Tasks</PRE>
<PRE>
    -pl_file xyz -&gt; Write out a mh perl code file.  These are the various
                    formats of Calendar subjects:</PRE>
<PRE>
                      vcr channel_num show_name (e.g. VCR 8 Dilbert)
                      voice_command  (e.g. Christmas lights on)
                      message_to_speak (e.g. Today is national geek day)</PRE>
<PRE>
                    Note:  If the text is not a vcr or voice_command, it
                           will be treated as a messages.</PRE>
<PRE>
    -date xyz    -&gt; Get data with a start_time on date xyz.  Default is today.
    -date_end xyz-&gt; Get data with a start_time between -date and -date_end
    -days xyz    -&gt; Look out xyz days from -date.  Default is 1 day.</PRE>
<PRE>
  Examples:
    outlook_read -help
    outlook_read -date 1/17
    outlook_read -date 12/25/97 -days 2
    outlook_read -pl_file /projects/mhcode/outlook_events.pl
    outlook_read</PRE>
<P></P>
<DT><STRONG><A NAME="item_report_weblog">report_weblog</A></STRONG><BR>
<DD>
report_weblog reads  MisterHouse and/or Apache server logs and
generates report graphs and optionally email them.
<P>Usage:</P>
<PRE>
  report_weblog [options] logfile(s)</PRE>
<PRE>
    -h        =&gt; This help text
    -help     =&gt; This help text</PRE>
<PRE>
    -ignore    xyz =&gt; A comma-delimited list of ip address to ignore.</PRE>
<PRE>
    -mailto     xyz =&gt; Will email the charts to xyz
    -mailserver xyz =&gt; xyz is the SMTP host.  Default is localhost</PRE>
<PRE>
    -runid      xyz =&gt; All graphs will have xyz as a prefix.  Default is blank.
    -outdir     xyz =&gt; All graphs be stored in directory xyz.  Default is .</PRE>
<PRE>
  Examples:
    report_weblog -mailto 'bruce@misterhouse.net' /var/log/httpd/access_log
    report_weblog -mailto winters@home.net -mailserver 24.2.1.70 e:/mh/data/logs/server.1999_07.log</PRE>
<P></P>
<DT><STRONG><A NAME="item_mhsend">mhsend</A></STRONG><BR>
<DD>
mhsend allows you to send data to mh over the intra/internet.  Data can be logged, filed, spoken, displayed,
or run.  The data processed by mh/code/test/mhsend_server.pl
<PRE>
  mhsend sends data to the MisterHouse program, through the internet/intranet.</PRE>
<PRE>
  The following flags control what the companion mh server.pl code does:</PRE>
<PRE>
    -file xxx    -&gt; Files the data into mh/data/mhsend/xxx</PRE>
<PRE>
    -log xxx     -&gt; Logs  the data into mh/data/mhsend/xxx.log</PRE>
<PRE>
    -run         -&gt; Runs the data as command.</PRE>
<PRE>
    -display xxx -&gt; Displays the data.  xxx is how log to leave the display up.</PRE>
<PRE>
    -speak       -&gt; Speaks and displays the data.</PRE>
<PRE>
    -pwfile xxx  -&gt; Points to a password file.</PRE>
<PRE>
  Usage:
    mhsend 'hi there'
    mhsend -display 60 hi there Bruce
    mhsend -port 8083 -host misterhouse.net 'hi there'
    mhsend -speak file_to_speak.txt
    mhsend -file file1 file_to_send.txt
    mhsend -log This is a good url:  <A HREF="http://goodplace.com">http://goodplace.com</A>
    echo 'hi there' | mhsend -stdin</PRE>
<P></P>
<DT><STRONG><A NAME="item_monitor_weblog">monitor_weblog</A></STRONG><BR>
<DD>
monitor_weblog monitors a Apache server log file.  When the server logs hits,
this code will summarize them and pass them onto the MisterHouse
speak_server.pl code via a tcp/ip socket.
<P>Usage:</P>
<PRE>
  monitor_weblog [options] logfile</PRE>
<PRE>
    -h        =&gt; This help text
    -help     =&gt; This help text</PRE>
<PRE>
    -mh_server xyz =&gt; The ip address of your MisterHouse box.
    -mh_port   xyz =&gt; The ip port you set mh.ini server_speak to.
    -ignore    xyz =&gt; A comma-delimited list of ip address to ignore.</PRE>
<PRE>
  Examples:
    monitor_weblog -mh_server house -ignore 'house,10.0.0.1' /var/log/httpd/access_log</PRE>
<P></P>
<DT><STRONG><A NAME="item_set_clock">set_clock</A></STRONG><BR>
<DD>
set_clock sets the clock according to the time from an internet connected NIST atomic clock server.
Instead of requiring accurate time zone information, set_clock will simply set 
the time minute and second, but will keep to the nearest hour it was already
set to.
<PRE>
  Usage:
    set_clock [options]</PRE>
<PRE>
  Options:
    -h         =&gt; This help text
    -help      =&gt; This help text</PRE>
<PRE>
    -no_set    =&gt; Do NOT set the clock, only list the difference in time.</PRE>
<PRE>
    -ignore xyz=&gt; Do NOT reset the local clock if the time is more then xyz minutes off.
                  Default=10</PRE>
<PRE>
    -method xyz=&gt; xyz can be inet_time, http, or socket.  Default is socket.</PRE>
<PRE>
    -server xyz=&gt; xyz is the server to get the clock data from.  Here are a few:
                    time-a.timefreq.bldrdoc.gov:14  (default)
                    time.nist.gov:??
                    time-nw.nist.gov:??</PRE>
<PRE>
  Example:
    set_clock 
    set_clock -server time-a.timefreq.bldrdoc.gov:14</PRE>
<PRE>
  More info about NIST clock servers if available at:
    <A HREF="http://www.boulder.nist.gov/doc-tour/atomic_clock.html">http://www.boulder.nist.gov/doc-tour/atomic_clock.html</A></PRE>
<P>Here is an example call from mh.  Since this is typically quick, we do it here with a 
'do' instead of a call with Process_Item:</P>
<PRE>
   if (time_cron '7 6 * * * ') {
     my $status = do &quot;$Pgm_Path/set_clock&quot;; 
     speak $status unless $Save{sleeping_parents};
   }</PRE>
<P></P>
<DT><STRONG><A NAME="item_set_password">set_password</A></STRONG><BR>
<DD>
set_password creates and/or queries the mh password file, using the crypt function.
If this password is set, then various menus (e.g. web, telnet, wap) will prompt for it.
<P>The crypt function limits the password to 8 characters.
To reset the password, delete the mh/data/.password file.</P>
<PRE>
  Usage:
    set_password [options]</PRE>
<PRE>
  Options:
    -h         =&gt; This help text
    -help      =&gt; This help text</PRE>
<PRE>
    -password xxx =&gt; xxx is the password to check.
                     If not used, a TK popup window will prompt for it.</PRE>
<PRE>
    -pw_file xxx  =&gt; xxx is the file that the crypt-ed password is read/written to.
                     Default is mh/data/.password</PRE>
<PRE>
  Example:
    set_password</PRE>
<P></P>
<DT><STRONG>speak</STRONG><BR>
<DD>
speak will pass the file or text to mh.  It simply runs the house program.

<PRE>

  Example:
    speak &quot;Boo, did I scare you?&quot;</PRE>
<P></P>
<DT><STRONG><A NAME="item_trivia">trivia</A></STRONG><BR>
<DD>
This will update trivia question and answer files from the specified database.  See mh/code/bruce/trivia.pl
for an example of how to call it from mh.
<P></P></DL>
<P>
<H2><A NAME="authentication">Authentication</A></H2>
<P>A one way crypt-ed password authentication scheme can be enabled for the web and telnet.pl interfaces.</P>
<P>The location of the crypt-ed password is controlled with the mh.ini password_file parm.  The default location
is in $Pgm_Root/data/.password.</P>
<P>If this file does not exist, the telnet.pl and web interface will be enable for anyone and everyone.
If it does exist, and the correct password is not entered, the telnet.pl and web function will not
implement the requested commands.</P>
<P>The set_password command is used to create and check this password.  If you are running the un-compiled perl and
do not have Tk installed, the password will have to be passed in with the -password parm (set_password -h for more help).
This can be run from a shell prompt or with the mh mh_control ``set the password'' command.</P>
<P>If you want to change the password, delete the password file and rerun set_password.</P>
<P>When prompted for UserName and Password from your web browser, you can leave UserName blank ... it is not used.</P>
<P>Netscape appears to allow you to re-try a password, but MS Explorer must be re-started if you want to enter a different
password.</P>
<P>
<H2><A NAME="customizing the menu interfaces">Customizing the Menu interfaces</A></H2>
<P>You can nested create menus that let you query mh data or control mh items or commands.
You can use use any or all of these interfaces to walk through menus:</P>
<PRE>
  Web browser:        <A HREF="http://localhost/sub?menu_html">http://localhost/sub?menu_html</A>
  WAP phone:          <A HREF="http://localhost/sub?menu_wml">http://localhost/sub?menu_wml</A>
  Tellme.com phone:   <A HREF="http://localhost/sub?menu_vxml">http://localhost/sub?menu_vxml</A>  
  LCD keypads:        see mh/code/bruce/lcdproc.pl for an example
  Audible feedback:   see mh/code/public/audible_menu.* for an example</PRE>
<P>To enable, use mh/code/test/menu.pl to read in menu files.
The format of the menu files is a simple text file, where each record is prefixed with a record type character.  
Here is an example:</P>
<PRE>
 M: Test            # Top level menu can have any name
    D: HVAC
    D: Lights
 M: HVAC
    D: Indoor temperature
       R: At $Time_Date, the temperature is $Weather{TempIndoor}
    D: Living fan [on,off] 
       A: set $living_fan $state
    D: Outdoor temperature
       A: What is the outdoor temperature
       R: last_response
    D: Humidity
       A: What is the humidity temperature
 M: Lights
    D: Camera [+,-,^,v]    
       A: Camera light [on,off,+30,-30]
       R: eval &quot;Light $state&quot; . chr(07) # Ring bell
    D: Bedroom [on,off,+30,-30]
       P: anyone
    M: Outside
 M: Outside
    P: anyone
    D: Garage Light [on,off,+30,-30]
    D: Backyard Light [on,off,+30,-30]</PRE>
<P>These are the record types:</P>
<PRE>
 M:  Menu screen
 D:  text to Display as a menu choice
 P:  Password bypass group
 A:  what Action to run (either a voice cmd or code to eval)
 R:  what Response to display. 
     last_response will pick up the last mh response
     If not specified, defaults to selecte state or last_response.
     Begin with eval to eval the string first.</PRE>
<P>The above example specifies 3 menu (M:) records that creates a Test menu, with 2 submenus, HVAC and Lights.</P>
<P>The HVAC 'Indoor temperature' display record (D:) will respond (R:) with the indoor $Weather data.</P>
<P>The 'Living fan' entry will evaluate the 'set $living_fan $state' action (A:) record to set the fan to the 
specified (on or off) state.</P>
<P>The 'Outdoor temperature' record will run a Voice_Cmd action (A:), and respond with the last
data printed or spoken by mh (the results of the outdoor temperature command).
The 'Humidity' record will also run a Voice_Cmd and default to last_response.</P>
<P>The 'Camera light' record also runs a Voice_Cmd action.
To save (LCD) display space, the on,off,+30,-30 Action states were renamed on the Display record to +,-,^,v.</P>
<P>The 'Bedroom' record matches a Voice_Cmd exactly, so no action record is required.  
It specifies a Password bypass group of anyone, meaning anyone can run this command without having to use a password.</P>
<P>The last Outside Light records are a 3rd level menu, nested under the 2nd level Lights menu.
There are no limits to how deep you can nest menus and they can appear in any order you want in the file.
The same menu can be a submenu of more than one other parent menu.</P>
<P>The Outside menu
specifies a P: record before any items are specified, so that is the default for all items on this menu,
meaning anyone can run the commands on this page without a password.</P>
<P>If you want a starting point to customize your own menus, you can find an auto-generated
menu for all the mh Voice_Cmds in the mh_temp.menu file in your code directory.
This file is re-generated on reload, so copy and edit this file, then point menu.pl at your edited copy.</P>
<P>You can have different sets of menus, for use with different interfaces or users.
For example, the default menu.pl looks like this:</P>
<PRE>
    my $menu_mh   = menu_create &quot;$config_parms{code_dir}/mh_temp.menu&quot;;
    my $menu_test = file_read   &quot;$config_parms{code_dir}/test.menu&quot;;
    menu_parse $menu_test, 'default';
    menu_parse $menu_mh,   'mh'; # This menu has all the mh voice commands</PRE>
<P>menu_create creates the example mh_temp.menu file for all voice commands and returns
it into $menu_mh.   $menu_test has the test menu, similar to the above example.
You can specify the menu group (e.g. default or mh) when calling any of the 
menu interface subroutines.  For the above menu.pl, you can point your WAP phone to:</P>
<PRE>
  Either of these will get the 'default' test menu:
    <A HREF="http://misterhouse.net:8080/sub?menu_wml">http://misterhouse.net:8080/sub?menu_wml</A>
    <A HREF="http://misterhouse.net:8080/sub?menu_wml">http://misterhouse.net:8080/sub?menu_wml</A>(default)</PRE>
<PRE>
  This will get the auto-generated 'mh' entry for all voice commands:
    <A HREF="http://misterhouse.net:8080/sub?menu_wml">http://misterhouse.net:8080/sub?menu_wml</A>(mh)</PRE>
<P>Something like this could be used to create different menus for different LCD controlers:</P>
<PRE>
  $menu_standard = read_file 'standard.menu';
  $menu_bedroom  = read_file 'bedroom.menu';
  $menu_living   = read_file 'living.menu';
  $menu_all      = read_file 'all.menu';</PRE>
<PRE>
  if ($Reread) {
    menu_parse $menu_bedroom  $menu_bedroom . $menu_standard,  'bedroom';  
    menu_parse $menu_living   $menu_living  . $menu_standard,  'living';  
    menu_parse $menu_all      $menu_all     . $menu_living .
                              $menu_bedroom . $menu_standard, 'all';
    $lcd_data{bed1}   {menu_group} = 'bedroom';
    $lcd_data{living1}{menu_group} = 'living';
    $lcd_data{living2}{menu_group} = 'all';
  }</PRE>
<P>To test your menus, point your browser to <A HREF="http://localhost:8080/sub?menu_html">http://localhost:8080/sub?menu_html</A> 
To view auto-generated menus, try <A HREF="http://localhost:8080/sub?menu_html(mh)">http://localhost:8080/sub?menu_html(mh)</A></P>
<P>If you have a LCD supported by lcdproc  program ( <A HREF="http://lcdproc.omnipotent.net">http://lcdproc.omnipotent.net</A> )
(e.g. crystalfontz or matrix-orbital), you can use mh/code/bruce/lcdproc.pl to display menus.
Currently only the linux version of lcdproc supports the keypad option on the maxrix-orbital displays.
Several other mh'ers are writing similar code for their LCD displays.</P>
<P>If you have a 24x7 internet connection, you can walk the menus with either
a WAP compatable cell phone, or using voice commands with any phone via a Voice Portal like
<A HREF="http://studio.tellme.com.">http://studio.tellme.com.</A></P>
<P>For cell phones, simply point your phone to <A HREF="http://your_domain/sub?menu_wml.">http://your_domain/sub?menu_wml.</A>  You can test your
menus with a web based phone simulator at <A HREF="http://www.yospace.com">http://www.yospace.com</A>
or download a phone simlator from <A HREF="http://phone.com">http://phone.com</A> .  
Other browsers are listed at <A HREF="http://www.palowireless.com/wap/browsers.asp">http://www.palowireless.com/wap/browsers.asp</A> ,
although I didn't have much luck with <A HREF="http://www.wapsilon.com">http://www.wapsilon.com</A> or /http://www.gelon.net .</P>
<P>Tellme.com currently offers free 1-800 access to their VR and TTS engines, using vxml (Voice XML) menus.
You can view the mh vxml menus by pointing a XML compatable browser (e.g. IE) to this address:</P>
<PRE>
   <A HREF="http://localhost:8080/sub?menu_vxml">http://localhost:8080/sub?menu_vxml</A></PRE>
<P>When ready to try with tellme, sign up for a free developer 
id, which will be your extention number.  I used Home0 (46630).
Then you can go to to my studio and enter your url:</P>
<PRE>
   <A HREF="http://studio.tellme.com/mystudio/mystudio.cgi">http://studio.tellme.com/mystudio/mystudio.cgi</A></PRE>
<PRE>
   <A HREF="http://your_domain/sub?menu_vxml">http://your_domain/sub?menu_vxml</A></PRE>
<P>where your_domain is your domain name or ip address.
To test, dial: 1-800-555-8965 (VXML) and enter your devloper ID and Pin.  
When you have it working, click on the MyExtentions, enter the same
URL and check the enable checkbox.  Now you can dial:</P>
<PRE>
   1-800-555-8355  (wait for 'tellme more') 1-yourextention</PRE>
<P>
<H2><A NAME="customizing the tk interface">Customizing the Tk Interface</A></H2>
<P>You can modify what the Tk window displays by modifying the tk_frame.pl and tk_widgets.pl members.  tk_frame.pl controls
the general layout and size of the various scrolled lists.  Modifying this member takes a little knowledge of perl Tk.</P>
<P>tk_widgets.pl shows how you can add widgets to display various info and allow for buttons for manual control.  The mh
tk_xxx subroutines used here will add widgets to either the menu_bar or to the 'grid' frame defined in tk_frame.pl.</P>
<P>Any change to tk_frame.pl or tk_widgets will be evaluated on a code reload, as will the tk_geometry parm in mh.ini.</P>
<P>tk_xxx widgets can be added anywhere in your mh code, not just the tk_widgets.pl member.  See the weather_monitor.pl, 
internet_mail.pl, and tk_eye.pl members in mh/code/bruce for examples.</P>
<P>The tk_xxx widgets are 'packed' into the menu_bar or grid in the order that they are evaluated.  You can use the
'Position' directive at the top of your member.pl code to control this.  Position=1 is reserved for the tk_frame.pl
member, as this must be evaluated first.</P>
<P>Note, you can also use native Perl tk commands, or create or override the tk_xxx subroutines in your own code for more
flexibility.</P>
<P>For more info on the tk_xxx widgets, see look in the mh functions section of this document.</P>
<P>
<H2><A NAME="customizing the web interface">Customizing the Web Interface</A></H2>
<P>You can write your own Web page interface.
The examples under mh/web are frame html files that dictate the shape and positions of various mh-generated html frames.</P>
<P>You can use the html_root and html_file mh.ini parms to point to the directory and default web page. 
The html_default parm are the member names used when the URL points to a directory.</P>
<P>The html_style mh.ini parm points to a style sheet that will be loaded for all mh-generated pages.  
Style sheets allow default control of colors and fonts.</P>
<P>There are other, html_* parms in the mh.ini file to control how the auto-generated html data looks.
For example, you can control table sizes and auto refresh rates.  See the mh.ini file for more info.</P>
<P>If you want to enable MsAgent support, use the mh.ini html_msagent_script* parm.
MsAgent allows remote IE web browsers to do TTS and VR on the remote box.
Note, you can do this even if you are running mh on a linux box as long as your remote box is running IE.
To enable, add the new mh.ini html_msagent_script* parms that
points to a mh/web file with the agent code (currently only Jeff's miniJeff agent is available).
Then click on the MSAgent checkbox at the top of the Web menu to turn him on or off.</P>
<P>IE, by default, will run each command only once, unless you change this setting:
Tools, Internet Options, General, Settings button on Temporary Internet
Files, under ``Check for new versions of stored pages'' select the option ``Every visit to the page.''</P>
<P>The web Items and Groups displays will use icons to indicate the object state.
Icons will be searched for in the mh/graphics directory according to 
the objects icon method, the object name, the object state, and the object type.
For example, given this code:</P>
<PRE>
    $fountain = new X10_Appliance('C3');
    set_icon $fountain 'water';</PRE>
<P>The search order for the ON state will be:</P>
<PRE>
    water-on.gif
    fountain-on.gif
    x10_appliance-on.gif
    on.gif</PRE>
<P>The web Category display will try to match icons to Voice_Cmd objects using the icon method, object name, 
voice command text, and filename.
For example, given this code from the member internet_data.pl:</P>
<PRE>
 $v_set_clock = new  Voice_Cmd('Set the clock via the internet');
 set_icon $v_set_clock 'time';</PRE>
<P>The search order will be:</P>
<PRE>
 Look for icons that match time
 Look for icons that match set_clock
 Look for icons that match words in 'Set the clock via the internet'
 Look for icons that match internet_data.pl</PRE>
<P>All icons in the graphics directory are compared to each of the above.  
The first match (by search order) is used.  If there are multiple matches, the
match with the longest word is used. 
For example, if we had icons names 'clock.gif' and 'internet.gif' (but no 'time.gif'),
'internet.gif' would be used.</P>
<P>In all of the above examples, .gif was used as an example, but any browser compatable graphics file can be used (e.g. .png and .jpg).
If you want to add new icons, some good sources are at
<A HREF="http://www.freegraphicland.com/">http://www.freegraphicland.com/</A> ,
<A HREF="http://www.graphsearch.com/">http://www.graphsearch.com/</A> ,
<A HREF="http://www.add-soft.com/icons/index.html">http://www.add-soft.com/icons/index.html</A> , 
<A HREF="http://www.rad.kumc.edu/icons/icons.htm">http://www.rad.kumc.edu/icons/icons.htm</A>  and 
<A HREF="http://www.engineeringplastics.com/HomeSeerIcons/">http://www.engineeringplastics.com/HomeSeerIcons/</A></P>
<P>Important note:  If you do play with adding/deleteing/renaming icons, you will want to do a reload before 
refreshing your browser.  The icon directory is cached by mh (for efficiency).  If no code has changed,
the reload will run very quickly.</P>
<P>You can use the following html addresses to have mh return dynaically generated html:</P>
<PRE>
  /category
    This will list all the Voice_Cmds, sorted by categories.  Categories are the member names of the 
    user code, or the value in the Category=value field specified in the user code.
    Items are also listed by Group, and Object Type</PRE>
<PRE>
  /list?Category
    This can be used to list just the commands in the specified Category.</PRE>
<PRE>
  /list;h_response?Category
    As above, but it also passes h_response to the RUN commands (see h_response below)</PRE>
<PRE>
  /group
    This will return all the Group Items</PRE>
<PRE>
  /group?$group_name
    This will return all the objects in $group_name</PRE>
<PRE>
  /items
    This will return all the non Voice Objects (e.g. X10_Items)</PRE>
<PRE>
  /items?object_type
    This will return all the objects of type object_type</PRE>
<PRE>
  /widgets
    This lists all the Tk widgets.</PRE>
<PRE>
  /widgets_label
    This returns just the label widgets</PRE>
<PRE>
  /widgets_entry
    This returns just the entry widgets</PRE>
<PRE>
  /widgets_radiobutton
    This returns just the radiobutton widgets</PRE>
<PRE>
  /widgets_checkbox
    This returns just the checkbox widgets</PRE>
<PRE>
  /speech
    This lists the most recently spoken text</PRE>
<PRE>
  /print_log
    This lists the most recently print_log text.</PRE>
<P>If you want to generate your own html on-the-fly (like a cgi program would), instead of pointing
to a .html file or or one of the above pre-defined mh-generated lists,
point to a .pl file and have that perl code return the desired html.  Note, this
currently differs from how a classic cgi program would work (they return the html as STDOUT).  
Some examples of this can be found in the mh/web/test/*.pl files.</P>
<P>One other note on .pl web files.  You can have them use variables you define in your mh user code, but only
if those variables are defined with ``use vars '$my_var1', '$my_var2'''.  Variables defined with ``my ($my_var1, $my_var2)''
are local only to the mh loop, and would not be available to any web .pl program.  
To pass arguments to your .pl file, append them to the url in normal CGI fasion after a ?.
For example:</P>
<PRE>
   <A HREF="http://misterhouse.net/test/test1.pl?argument1&amp">http://misterhouse.net/test/test1.pl?argument1&amp</A>;argument2</PRE>
<P>In addition to calling the above mh-generated html directly, you can embed these lists in your own html
using the server-side-include syntax.  If the extention on your html is .shtml (for server-side html)
then mh will parse the html, looking for the following string:</P>
<PRE>
   &lt;!--#include file=&quot;your_directive&quot;--&gt;</PRE>
<P>Anytime the above string is found, it will replace that record with whatever you specify in ``your_directive''.
``your_directive'' can either be another html (or shtml) file, or it can be one of the mh-generated lists
from above.  For example:</P>
<PRE>
  &lt;!--#include file=&quot;/mh/other_links.html&quot;--&gt;
  &lt;!--#include file=&quot;category&quot;--&gt;
  &lt;!--#include file=&quot;/mh_default/test/test1.pl&quot;--&gt;</PRE>
<P>You can use an #include var= directive, like file= above except it returns the contents
of an mh variable.  For example:</P>
<PRE>
  &lt;li&gt;&lt;b&gt;Version:&lt;/b&gt; &lt;!--#include var=&quot;$Version&quot;--&gt;</PRE>
<P>This what is used in the mh 'About' web button to return the mh version.</P>
<P>You can also define your own functions in your code files to return html, and then call them 
with the code= include directive or as a h_response to a /SET or /RUN command (see below).
For example, add these to any of your code files:</P>
<PRE>
  sub web_func1 {
     return &quot;uptime = &quot; . &amp;time_diff($Time_Startup_time,$Time , undef, 'numeric');
  }
  sub web_func2 {
     my ($arg1, $arg2) = @_;
     return &quot;results from function 2: $arg1, $arg2&quot;; 
  }</PRE>
<PRE>
  # Add this if you want unauthorized web access to these functions  
  if ($Reload) {
    $Password_Allow{'&amp;web_func1'} = 1;
    $Password_Allow{'&amp;web_func2'} = 1;
  }</PRE>
<P>Then call them like this:</P>
<PRE>
 &lt;p&gt;Test web functions
 &lt;!--#include code=&quot;&amp;web_func1&quot;--&gt;
 &lt;!--#include code=&quot;&amp;web_func2(myarg1,myarg2)&quot;--&gt;</PRE>
<P>Or with this:</P>
<PRE>
 <A HREF="http://localhost:8080/SET">http://localhost:8080/SET</A>;&amp;web_func2(myarg1,myarg2)</PRE>
<P>One useful built in function is &amp;dir_index, which can be used to create a directory
listing of files in selected directories.  For example, if you have a web
directory called pictures, create an index.shtml file, and include
the following line:
</P>
<PRE>

    &lt;!--#include code=&quot;&amp;dir_index('/pictures','name',0)&quot;--&gt;</PRE>
<P>You can have &amp;dir_index sort by name, type, size, or date.  Set the 3rd argument to 1 for reverse sort order.
An optional 4th parameter is a regular expresion that can be used to subset to matching files.
See mh/web/graphics/index.shtml and mh/data/email/index.shtml for examples.</P>
<P>If you want to have only a few specific html controls, you can write your own html using the
RUN and SET (or SET_VAR) url keywords to control mh.  Here are a few examples:</P>
<PRE>
 &lt;a href=<A HREF="http://localhost:8080/SET">http://localhost:8080/SET</A>?$test_lights?off &gt;Turn the test light off&lt;/a&gt;
 &lt;a href=<A HREF="http://localhost:8080/SET">http://localhost:8080/SET</A>?$Save{test_input1}?abc &gt;Load test_input1 with abc&lt;/a&gt;
 &lt;a href=<A HREF="http://localhost:8080/RUN?WebCam_light_on">http://localhost:8080/RUN?WebCam_light_on</A> &gt;WebCam light on&lt;/a&gt;</PRE>
<P>The SET (or SET_VAR ... they are now the same) command can set any object or variable defined in your user code.
The RUN command can run any voice command.
Use '_' to replace blanks in the command string.</P>
<P>SET, RUN, or SUB can use an optional h_response field to decide what html will be returned:</P>
<PRE>
  Format:
   SET;h_response?$object?value 
   RUN;h_response?command
   SUB;h_response?sub_name(arg1,arg2)</PRE>
<PRE>
  $var and $object are the variable and object names, with or without the $ prefix.</PRE>
<PRE>
  h_response is optional and can be one of the following:
   &amp;function        The results of &amp;function will be returned
   &amp;function(args)  The results of &amp;function(arg) will be returned
   last_response    The last displayed or spoken text. 
   last_response_## As above, but only the first ## characters.
   last_displayed   The last displayed text will be returned
   last_spoken      The last spoken item will be returned
   filexyz.html     The contents of filexyz.html will be returned
   string           string will be returned
   referer          The browser will be re-directed back to the calling page
   <A HREF="http://url">http://url</A>       The browser will be re-directed to url
   blank:           A list of recently spoken text will be returned</PRE>
<P>Here are some examples demonstrating these options:</P>
<PRE>
 This returns the last spoken line:
  &lt;li&gt;&lt;a href=<A HREF="http://localhost:8080/RUN">http://localhost:8080/RUN</A>;last_spoken?WebCam_light_on&gt;Light on&lt;/a&gt;</PRE>
<PRE>
 This returns the string &quot;Thanks for playing&quot;
  &lt;li&gt;&lt;a href=<A HREF="http://localhost:8080/RUN">http://localhost:8080/RUN</A>;Thanks_for_playing?WebCam_light_off&gt;Light off&lt;/a&gt;</PRE>
<PRE>
 This returns the contents of the mh/web/test/test3.html file:
  &lt;li&gt;&lt;a href=<A HREF="http://localhost:8080/RUN">http://localhost:8080/RUN</A>;test/test3.html?WebCam_light_+50&gt;+50&lt;/a&gt;</PRE>
<PRE>
 This returns a list of recently spoken text:
  &lt;li&gt;&lt;a href=<A HREF="http://localhost:8080/RUN?WebCam_light_-50&gt">http://localhost:8080/RUN?WebCam_light_-50&gt</A>;-50&lt;/a&gt;</PRE>
<PRE>
 This will allow for text input, using a html FORM, and returning the the results
 form the user defined function &amp;my_response (Note, to give anyone access to this 
 function you will need to authorize &amp;my_response with this in your code: 
 $Password_Allow{'&amp;my_response'} = 1):</PRE>
<PRE>
  HTML:
   &lt;form action=&quot;SET;&amp;my_response&quot;&gt;Test 2&lt;input size=9 name=&quot;$test_form&quot;&gt;&lt;/form&gt;
</PRE>
<PRE>

  User code:
   $test_form = new Generic_Item;
   print_log $state if $state = state_now $test_form;
   sub my_response {
     return &quot;You entered &quot; . state $test_form;
   }</PRE>
<PRE>
 This will set a $barcode_scan Generic_Item, then display a web page 
 that was updated by user code:</PRE>
<PRE>
  &lt;FORM ACTION=&quot;SET;barcode_search.html&quot;  target='speech'&gt;
  &lt;p&gt;Scan data into here: &lt;INPUT SIZE=60 NAME=&quot;$barcode_scan&quot; value=&quot;&quot;&gt;&lt;/FORM&gt;</PRE>
<P></P>
<PRE>
 This will redirect the browser back to the calling page 
 (note the $ from the $camera_light object is optional):</PRE>
<PRE>
  &lt;a HREF=&quot;<A HREF="http://misterhouse.net:8080/SET">http://misterhouse.net:8080/SET</A>;Referer?camera_light=on&quot;&gt;Light on&lt;/a&gt;</PRE>
<PRE>
 This will redirect the browser to misterhouse.net</PRE>
<PRE>
  &lt;a HREF=&quot;<A HREF="http://misterhouse.net:8080/SET">http://misterhouse.net:8080/SET</A>;<A HREF="http://misterhouse.net">http://misterhouse.net</A>?$camera_light=off&quot;&gt;Light off&lt;/a&gt;</PRE>
<P>You can also use RUN;h_response without a command.
For example, if you want to get a directory listing, sorted by date (recent on top):</P>
<PRE>
  &lt;a href=<A HREF="http://localhost:8080/RUN">http://localhost:8080/RUN</A>;&amp;dir_index('/pictures','date',1)&gt;List pictures by date &lt;/a&gt;</PRE>
<P>Here is an example of using a subroutine to generate html:</P>
<PRE>
   <A HREF="http://misterhouse.net:8080/SUB">http://misterhouse.net:8080/SUB</A>;tellme_menu(,,html)</PRE>
<P>You can also use a seperate web server (e.g. Apache or ISS) to serve pages that control MisterHouse. 
For example:</P>
<PRE>
  Turn lamp
  &lt;a href=&quot;<A HREF="http://localhost:8080/SET">http://localhost:8080/SET</A>;referer?$light1?on&quot;&gt;on&lt;/a&gt;
  &lt;a href=&quot;<A HREF="http://localhost:8080/SET">http://localhost:8080/SET</A>;referer?$light1?off&quot;&gt;off&lt;/a&gt;</PRE>
<P>To enable on-the-fly icons to that show current item states, add this function to your code:</P>
<PRE>
 sub web_icon_state {
     my ($item) = @_;
     my $obj   = &amp;get_object_by_name($item);
     my $state = $obj-&gt;state;
     my $icon  = &quot;$main::config_parms{html_dir}/graphics/$state.gif&quot;;
     print &quot;db icon=$icon s=$state i=$item\n&quot;;
     my $image = file_read $icon;
     return $image;
 }</PRE>
<P>Then add this to your html:</P>
<PRE>
  &lt;img src=<A HREF="http://localhost:8081/sub?web_icon_state">http://localhost:8081/sub?web_icon_state</A>('$light1')&gt;</PRE>
<P>
<H2><A NAME="voice recognition (vr) and text to speech (tts) on windows">Voice Recognition (VR) and Text To Speech (TTS) on windows</A></H2>
<P>VR and TTS options are controlled with the Microsoft Voice application.  It shows up as a 'green V' in your icon tray.   Right
clicking on this icon brings various menus for configuring your VR and TTS options.</P>
<P>You can pick between 3 VR modes, by right clicking on the MS Voice icon, or toggle between the modes by left clicking on the icon.</P>
<PRE>
  - Listening for Voice Commands</PRE>
<PRE>
    This mode will listen to anything and everything.  You can get lots of false
    recognition in noisy environments in this mode.</PRE>
<PRE>
  - Not listening</PRE>
<PRE>
    In this mode, VR will be turned on only when you hold down an activation key or
    move the mouse to a screen corner, depending on which 'Listening Mode' you
    pick in the 'Voice Command Options' menu.</PRE>
<PRE>
  - Paused listening</PRE>
<PRE>
    This mode only listens for a specific trigger keyword.  If heard, then it
    temporarily switches to normal listening mode. The trigger keyword is listed 
    as your 'Computer Name' in the 'Voice Command Options' menu.</PRE>
<P>You can improve your Voice Recognition accuracy by talking through a 10 minute training session.  
Right click on the MS Voice icon and pick 'Voice Command Options', then click on the 'Advanced' tab, and finally click
on the 'Optional Training' button.</P>
<P>You can pick the voice and speed of the TTS by clicking on the 'Computer Voice' tab on the 
same 'Voice Command Options' dialog.</P>
<P>
<H2><A NAME="voice recognition (vr) and text to speech (tts) on unix">Voice Recognition (VR) and Text To Speech (TTS) on Unix</A></H2>
<P>Need notes on how to use viavoic on linux and how to enable different TTS engines with Festival.</P>
<P>For vr with viavoice, use mh/code/bruce/viavoice_control.pl</P>
<P>
<HR>
<H1><A NAME="notes">NOTES</A></H1>
<P>This section has info that doesn't fit well anywhere else.  Probably be better as a FAQ.</P>
<P>My hope is that mh will grow into a group project.  There is so many, almost unlimited
possibilities in Home Automation, that no one person could hope to implement them all.</P>
<P>If you feel so inclined, please send me any code that you develop that you think others
might be interested in, and I'll include it in the distribution.</P>
<P>If you would rather see it mh in your windows tray, rather in the taskbar, here is a 
useful utility that will let you move any program to the tray: <A HREF="http://www.teamcti.com/TrayIt">http://www.teamcti.com/TrayIt</A></P>
<P>Another handy utility for windows 95/98 users will help you monitor how much cpu and memory mh takes.
TaskInfo80, available at <A HREF="http://www.iarsn.com/index.html">http://www.iarsn.com/index.html</A></P>
<P>If you are getting the message ``Out of environment space'' try adding these records:</P>
<PRE>
  config.sys:   shell=command.com /e:8000 /p
  autoexec.bat: set comspec=c:\command.com</PRE>
<P>If you want to use a program generated list in an Item declaration, you need to use add # noloop=start/stop
comments before and after the code that should preceed the Item.  Here is an example:</P>
<PRE>
  # noloop=start
  my $mp3names;
  while ( my $mp3name = &lt;d:/library/*.m3u&gt; )
   {
    $mp3name =~ s#^.*/##;  # remove path
    $mp3name =~ s#\..*$##; # remove extension
    $mp3names .= &quot;,&quot; if $mp3names;
    $mp3names .= $mp3name;
   }
  # noloop=stop</PRE>
<PRE>
  $v_play_music = new Voice_Cmd(&quot;Play [$mp3names]&quot;);
  if ($state = said $v_play_music) {
    ... more code here ...</PRE>
<P>If you want to have a user defined function called once perl loop, 
but you want it before or after all the other user code has been
called, use the &amp;MainLoop_pre_add_hook and 
&amp;MainLoop_post_add_hook functions to add callbacks to your functions.  For example:</P>
<PRE>
  $v_hook_pre_add   = new Voice_Cmd 'Add  pre  code hook';
  $v_hook_pre_drop  = new Voice_Cmd 'Drop pre  code hook';
  $v_hook_post_add  = new Voice_Cmd 'Add  post code hook';
  $v_hook_post_drop = new Voice_Cmd 'Drop post code hook';</PRE>
<PRE>
  &amp;MainLoop_pre_add_hook(  \&amp;test_hook_pre)  if said $v_hook_pre_add;
  &amp;MainLoop_pre_drop_hook( \&amp;test_hook_pre)  if said $v_hook_pre_drop;
  &amp;MainLoop_post_add_hook( \&amp;test_hook_post) if said $v_hook_post_add;
  &amp;MainLoop_post_drop_hook(\&amp;test_hook_post) if said $v_hook_post_drop;</PRE>
<PRE>
  sub test_hook_pre  { print &quot;&lt;&quot;; }
  sub test_hook_post { print &quot;&gt;&quot;; }</PRE>
<P>If you want your hook code to last between code reloads (e.g. added by startup code from a module), 
set 2nd argument to 'persistent' (a value of 1 will also work ... grandfathered in for old code).
For example:</P>
<PRE>
  &amp;main::MainLoop_post_drop_hook( \&amp;jabber::process, 'persistent' );</PRE>
<P>If you want that hook to run first, before all other hooks of that type, set the 2nd argument 
to 'first', or 'persisent_first'.  Otherwise the hook is pushed to the end of the list, so 
it is run in the order the hooks were added.</P>
<P>Here is a list of all the code hook locations:</P>
<PRE>
  MainLoop_pre   =&gt; Run before user code 
  MainLoop_post  =&gt; Run before user code 
  Serial_match   =&gt; Run when incoming serial data matches and object
  State_change   =&gt; Run when objects change states
  Play_pre       =&gt; Run before playing wav files
  Play_post      =&gt; Run after  playing wav files
  Speak_pre      =&gt; Run before speaking text files
  Speak_post     =&gt; Run after  speaking text files</PRE>
<P>For more examples on code hooks, see mh/code/bruce/test_code_hooks.pl</P>
<P>
<HR>
<H1><A NAME="known limitations and bugs">KNOWN LIMITATIONS AND BUGS</A></H1>
<P>
<H2><A NAME="general bugs/limitations">General bugs/limitations</A></H2>
<P>The JDS and Marrick interface modules are untested.</P>
<P>mh also has the the 'windows 49.7 day bug' (2**32 milliseconds) that has been in the news lately: 
<A HREF="http://www.news.com/News/Item/0,4,33117,00.html?st.ne.ni.rel">http://www.news.com/News/Item/0,4,33117,00.html?st.ne.ni.rel</A> .</P>
<P>Under windows, TK windows do not get focus and some keys and shortcuts do not work.  Worse yet, the 
'tear off' line (the dashed line on the pull down menus) causes mh to hang.  Perl/tk on unix does not
have either of these problems.
Hopefully this will get fixed in a future release of perl/Tk.  Note: if you have an old perl/tk (older
than 8.0012), things are even more messed up.</P>
<P>
<H2><A NAME="windows bugs/limitations">Windows bugs/limitations</A></H2>
<P>If 'run' calls give you an 'out of environment memory' error, create a command.pif
and change the memory, initial environment from auto to 4k.</P>
<P>Activestate perl 5.6 build 613 and 616 leaks memory on windows.  On my box about 30 Meg, once a day. 
Displaying .gif and .jpg files also leaks about 10x the picture size (e.g 10 50k photos -&gt; 5 meg).</P>
<P>Adding, deleting, or changing Voice commands does is not recognized by the Windows MSVoice
application while it is running.
You have to exit and restart MSVoice, then restart mh to get it to recognize new commands.
Hopefully we can get this to work with release 5.0 of the MS Speech SDK.</P>
<P>If you have perl installed, you may get this message:</P>
<PRE>
  Can't find 'boot_IO' symbol ...</PRE>
<P>The problem is there are two different IO.DLL files, one in the FTP module and one in the TK module.
Do a find in IO.DLL in your perl directory, and rename the one in the tk path.</P>
<P>
<H2><A NAME="unix bugs/limitations">Unix bugs/limitations</A></H2>
<P>Voice Recognition IS supported under linux using IBM's ViaVoice SDK.
Potential candidates for VR engines other non-linux unix platforms are:</P>
<PRE>
     <A HREF="http://www.speech.cs.cmu.edu/sphinx/">http://www.speech.cs.cmu.edu/sphinx/</A>
     <A HREF="http://cslu.cse.ogi.edu/index.html">http://cslu.cse.ogi.edu/index.html</A> 
     <A HREF="http://WWW.ISIP.MsState.Edu/projects/speech_recognition/">http://WWW.ISIP.MsState.Edu/projects/speech_recognition/</A>
     <A HREF="http://www.tmt.de/~stephan/ears.html">http://www.tmt.de/~stephan/ears.html</A></PRE>
<P>Disk drive info (need to port from DriveInfo to df)</P>
<P>Linux KDE users should uncheck ``Apply fonts and colors to non-KDE apps'', 
or the black text on white windows shows up as white text.</P>
<P>
<HR>
<H1><A NAME="authors">AUTHORS</A></H1>
<P>Bruce Winter: <A HREF="mailto:bruce@misterhouse.net">bruce@misterhouse.net</A> ,  <A HREF="http://winters.ws">http://winters.ws</A></P>
and <a href="authors.html">a bunch of fellow home hackers</a><P>
<HR>
<H1><A NAME="see also">SEE ALSO</A></H1>
<P>mh can be download from <A HREF="http://misterhouse.net:81">http://misterhouse.net:81</A></P>
<P>Here is a list of articles written about MisterHouse:</P>
<PRE>
  <A HREF="http://www.hometoys.com/htinews/jun99/articles/winter/winter.htm">http://www.hometoys.com/htinews/jun99/articles/winter/winter.htm</A></PRE>
<PRE>
  <A HREF="http://linuxworld.com/linuxworld/lw-1999-10/lw-10-mrhouse.html">http://linuxworld.com/linuxworld/lw-1999-10/lw-10-mrhouse.html</A></PRE>
<PRE>
  <A HREF="http://www.faribault.k12.mn.us/brian/aprs/">http://www.faribault.k12.mn.us/brian/aprs/</A></PRE>
<PRE>
  <A HREF="http://www.circuitcellar.com/pastissues/articles/winter111/winter.pdf">http://www.circuitcellar.com/pastissues/articles/winter111/winter.pdf</A></PRE>
<PRE>
  <A HREF="http://www.itknowledge.com/tpj/issues/vol5_1/tpj0501-0006.html">http://www.itknowledge.com/tpj/issues/vol5_1/tpj0501-0006.html</A>
    (User login to The Perl Journal is required)</PRE>
<P>The Circuit Cellar Ink article includes a diagram of how 
to set up a house PA system, so you can control which rooms MisterHouse talks to.</P>
<P>You can suscribe and/or view the mailing list at
<A HREF="http://sourceforge.net/mail/?group_id=1365">http://sourceforge.net/mail/?group_id=1365</A>
You can view the archive at
<A HREF="http://lists.sourceforge.net/pipermail/misterhouse-users/">http://lists.sourceforge.net/pipermail/misterhouse-users/</A>
and search it at 
<A HREF="http://lists.sourceforge.net/mailman/listinfo/misterhouse-users">http://lists.sourceforge.net/mailman/listinfo/misterhouse-users</A></P>
<P>An older list with a searchable archive at &lt;a href=http://www.onelist.com/messages/MisterHouse&gt;here&lt;/a&gt;).</P>
<P>Jan Dubois has a fun page of other ticks you can do with 
perl on windows at <A HREF="http://opensource.activestate.com/authors/jandubois/Perl/TPC3/fun.html">http://opensource.activestate.com/authors/jandubois/Perl/TPC3/fun.html</A></P>
<P>The comp.home.automation newsgroup is another handy resource, especially for X10 related questions.</P>
<P>Neil Cherry has created a home for linux related Home Automation programs at
<A HREF="http://linuxha.sourceforge.net">http://linuxha.sourceforge.net</A> .  This project is developing daemons for various interfaces
(e.g. ADI Ocelot, CPUXA, and HCS II) that hopefully we can then link to with mh.</P>
<P>Rene Mueller has a nice set of web pages with lots of info on HomeAppliances at
<A HREF="http://the-labs.com/HomeNetwork/">http://the-labs.com/HomeNetwork/</A></P>
<P>
<HR>
<H1><A NAME="copyright">COPYRIGHT</A></H1>
<P>Copyright (C) 1998-2001 Bruce Winter. All rights reserved.</P>
<P>This program is free software; you can redistribute it and/or modify it under the 
terms of the GNU public license.</P>
<P>
<HR>
<H1><A NAME="disclaimer">DISCLAIMER</A></H1>
<P>This program will most likely not cause your house to self destruct, but if it does, please don't call
my lawyer.  Actually, I suppose you could try to call my lawyer, since I don't have one I don't think 
you will get too far (grin).</P>

</BODY>

</HTML>
